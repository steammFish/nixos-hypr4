var background=function(e){"use strict";function t(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function n(){return crypto.randomUUID()}function a(){const e=new Uint32Array(28);return crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).slice(-2))).join("")}function r(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}const o=[{langCode:"DE",langCodeForSpeech:"de-DE",supportsFormality:!0},{langCode:"EN-GB",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"EN-US",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"FR",langCodeForSpeech:"fr-FR",voice:"Thomas",supportsFormality:!0},{langCode:"ES",langCodeForSpeech:"es-ES",voice:"Google espaÃ±ol",label:"ES",supportsFormality:!0},{langCode:"IT",langCodeForSpeech:"it-IT",supportsFormality:!0},{langCode:"ID",langCodeForSpeech:"id-ID"},{langCode:"PL",langCodeForSpeech:"pl-PL",supportsFormality:!0},{langCode:"NL",langCodeForSpeech:"nl-NL",voice:"Google Nederlands",label:"NL",supportsFormality:!0},{langCode:"PT-PT",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"PT-BR",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"RU",langCodeForSpeech:"ru-RU",supportsFormality:!0},{langCode:"ZH",langCodeForSpeech:"zh-CN"},{langCode:"JA",langCodeForSpeech:"ja-JP",supportsFormality:!0},{langCode:"BG",langCodeForSpeech:"bg-BG"},{langCode:"CS",langCodeForSpeech:"cs-CZ"},{langCode:"DA",langCodeForSpeech:"da-DK"},{langCode:"ET",langCodeForSpeech:"et"},{langCode:"FI",langCodeForSpeech:"fi-FI",voice:"Satu"},{langCode:"EL",langCodeForSpeech:"el-GR"},{langCode:"HU",langCodeForSpeech:"hu-HU"},{langCode:"LV",langCodeForSpeech:"lv"},{langCode:"LT",langCodeForSpeech:"lt"},{langCode:"RO",langCodeForSpeech:"ro-RO"},{langCode:"SK",langCodeForSpeech:"sk-SK"},{langCode:"SL",langCodeForSpeech:"sl"},{langCode:"SV",langCodeForSpeech:"sv-SE"},{langCode:"TR",langCodeForSpeech:"tr-TR"},{langCode:"UK",langCodeForSpeech:"uk-UA"},{langCode:"NB",langCodeForSpeech:"nb-NO"},{langCode:"KO",langCodeForSpeech:"ko-KR"}],s=0,i={inline:"inline",automatic:"automatic",manual:"manual",input:"input"},c={notLoggedIn:1,loggedInPro:2,loggedInFree:3},l={notLoggedIn:1500,loggedInFree:5e3},d={defaultPopup:1,fptInjectedPopup:2,inlineTooltipPopup:3},g={extensionIcon:1,fptAutoInject:2},u={defaultPopup:1,injectedFptPopup:2,inlinePopup:3},p={hintKeyboardShortcut:"HINT_KEYBOARD_SHORTCUT",inputTranslation:"INPUT_TRANSLATION",inlineTranslation:"INLINE_TRANSLATION",fullPageTranslation:"FULL_PAGE_TRANSLATION",accountSuccessfullyCreated:"ACCOUNT_SUCCESSFULLY_CREATED",successfullyLoggedIn:"SUCCESSFULLY_LOGGED_IN"},h={inlineTranslationTriggerIcon:"INLINE_TRANSLATION_TRIGGER_ICON",inlineTranslationSettingsIcon:"INLINE_TRANSLATION_SETTINGS_ICON",inlineTranslationSettingPopup:"INLINE_TRANSLATION_SETTING_POPUP",inputTranslationTriggerIcon:"INPUT_TRANSLATION_TRIGGER_ICON",inputTranslationSettingsIcon:"INPUT_TRANSLATION_SETTINGS_ICON",inputTranslationSettingPopup:"INPUT_TRANSLATION_SETTING_POPUP",settingsPageFPT:"SETTINGS_PAGE_FPT",settingsPageReading:"SETTINGS_PAGE_READING",settingsPageWriting:"SETTINGS_PAGE_WRITING",settingsPageIntegrations:"SETTINGS_PAGE_INTEGRATIONS",fptHideModal:"FPT_HIDE_MODAL",inputTranslationReadMoreLink:"INPUT_TRANSLATION_READ_MORE_LINK",inlineTranslationReadMoreLink:"INLINE_TRANSLATION_READ_MORE_LINK",fptTranslationReadMoreLink:"FPT_TRANSLATION_READ_MORE_LINK",extensionHubToggleSwitch:"EXTENSION_HUB_TOGGLE_SWITCH",hubCustomizeShortcut:"HUB_CUSTOMIZE_SHORTCUT",hubLoginButton:"HUB_LOGIN_BUTTON",hubUpgradeToProLink:"HUB_UPGRADE_TO_PRO_LINK",hubTryProLink:"HUB_TRY_PRO_LINK",settingsPageCustomizeShortcutButton:"SETTINGS_PAGE_CUSTOMIZE_SHORTCUT_BUTTON",hubFPTEnableCheckbox:"HUB_FPT_ENABLE_CHECKBOX",hubFPTDisableCheckbox:"HUB_FPT_DISABLE_CHECKBOX",deeplWriteIcon:"DEEPL_WRITE_ICON",gmailOnboardingPopup:"gmailOnboardingPopup",gmailOnboardingIcon:"gmailOnboardingIcon",gmailCharLimitLogin:"gmailCharLimitLogin",gmailFeedbackSurvey:"gmailFeedbackSurvey",hubViewIntegrations:"HUB_VIEW_INTEGRATIONS",hubCloseCustomizationsWidget:"HUB_CLOSE_CUSTOMIZATIONS_WIDGET",gslidesFeedbackSurvey:"GSLIDES_FEEDBACK_SURVEY",gslidesCharLimitLogin:"GSLIDES_CHAR_LIMIT_LOGIN",zendeskTryProLink:"ZENDESK_TRY_PRO_LINK",onboardingSignUp:"ONBOARDING_SIGN_UP",onboardingSkipSignUp:"ONBOARDING_SKIP_SIGN_UP",onboardingLoginLink:"ONBOARDING_LOGIN_LINK",onboardingSeeAllIntegrations:"ONBOARDING_SEE_ALL_INTEGRATIONS"},m={triggerTranslation:"trigger-translation",changeLanguage:"change-language"},E={clickOnShortcutNotifiction:"CLICK_ON_SHORTCUT_NOTIFICATION",clickOnInlineTranslationShowAlternatives:"CLICK_ON_INLINE_TRANSLATION_SHOW_ALTERNATIVES",clickOnInlineTranslationCloseIcon:"CLICK_ON_INLINE_TRANSLATION_CLOSE_ICON",clickOnLogoutMenuEntry:"CLICK_ON_LOGOUT_MENU_ENTRY"},T={disablePerSite:"DISABLE_PER_SITE",disableEverywhere:"DISABLE_EVERYWHERE",enableEverywhere:"ENABLE_EVERYWHERE",enablePerSite:"ENABLE_PER_SITE"},_={inputTranslation:"INPUT_TRANSLATION",inlineTranslation:"INLINE_TRANSLATION",fullPageTranslation:"FULL_PAGE_TRANSLATION",gdocs:"GDOCS"},f={top:1,right:2,bottom:3,left:4},w={openPage:"OPEN_PAGE",backButton:"BACK_BUTTON",nextButton:"NEXT_BUTTON",navigation:"NAVIGATION"},I={unspecified:0,chrome:1,edge:2,local:3,firefox:4},L={chrome:"cofdbpoegempjloogbagkncekinflcnj",edge:"fancfknaplihpclbhbpclnmmjcjanbaf",local:"ocpdpnakdghopjcifldjidbdmfobmmoi",firefox:"firefox-extension@deepl.com"},S={deepl:1,linguee:2,google_translate:3,word_365:4,power_point_365:5,jira:6,confluence:7,gmail:8},y=5,R={default:"DEFAULT",gdocs:"GDOCS",zendesk:"ZENDESK",whatsappWeb:"WHATSAPP_WEB",twitter:"TWITTER",gmail:"GMAIL",gslides:"GSLIDES",linkedIn:"LINKEDIN"},A={translate:"translate",write:"write"},N={user:"USER",extension:"EXTENSION"},C={OPEN_TICKET:"OPEN_TICKET",DETECT_TICKET_LANGUAGE:"DETECT_TICKET_LANGUAGE",SWITCH_TICKET_LANGUAGE:"SWITCH_TICKET_LANGUAGE",ENABLE_AUTOTRANSLATE:"ENABLE_AUTOTRANSLATE",DISABLE_AUTOTRANSLATE:"DISABLE_AUTOTRANSLATE",TRANSLATE_MESSAGE:"TRANSLATE_MESSAGE",TRANSLATE_INPUT:"TRANSLATE_INPUT",ERROR:"ERROR"},O={translation:"TRANSLATION",login:"LOGIN"},b={chat:"CHAT",message:"MESSAGE"},D={free:"free",pro:"pro",none:"none"},k={TEXT_REFINEMENT_REQUEST:"TEXT_REFINEMENT_REQUEST",GDOCS_INSERT_COPY:"GDOCS_INSERT_COPY",GDOCS_DISCARD_COPY:"GDOCS_DISCARD_COPY",GDOCS_CHAR_LIMIT_REACHED:"GDOCS_CHAR_LIMIT_REACHED",RESULT_ACCEPTED:"RESULT_ACCEPTED",RESULT_REVERTED:"RESULT_REVERTED",ERROR:"ERROR"},P={RESULT_ACCEPTED:"RESULT_ACCEPTED",RESULT_REVERTED:"RESULT_REVERTED",ERROR:"ERROR"},x={ALTERNATIVES_OPENED:"ALTERNATIVES_OPENED",SEGMENTATION_SELECTED:"SEGMENTATION_SELECTED",ALTERNATIVE_SELECTED:"ALTERNATIVE_SELECTED"},v={READING_VIEW_TRANSLATE:"READING_VIEW_TRANSLATE",COMPOSE_VIEW_TRANSLATE:"COMPOSE_VIEW_TRANSLATE",COMPOSE_VIEW_IMPROVE:"COMPOSE_VIEW_IMPROVE"},U={ANONYMOUS_USER_LIMIT_EXCEEDED:"ANONYMOUS_USER_LIMIT_EXCEEDED",FREE_ACCOUNT_LIMIT_EXCEEDED:"FREE_ACCOUNT_LIMIT_EXCEEDED"},F={PRO_TRIAL:"PRO_TRIAL",LOGIN:"LOGIN",SIGNUP:"SIGNUP"},G={WORD:"word",SENTENCE:"sentence"},M={none:"None",pro:"Pro",free:"Free"},W={share_feedback_survey:"DOCS_GOOGLE_COM_FEEDBACK_FORM",new_share_feedback_survey:"NEW_FEEDBACK_FORM",try_DeepL_Pro:"DEEPL_COM_PRO",show_more_translation:"DEEPL_COM_TRANSLATOR",deepl_translator_home:"DEEPL_COM_HOMEPAGE",deepl_write_home:"DEEPL_COM_WRITE",deepl_terms_of_service_free:"DEEPL_COM_TERMS_OF_SERVICE_FREE",deepl_create_account:"DEEPL_CREATE_ACCOUNT",deepl_translator_docs:"DEEPL_COM_DOCTRANS",shortcut_settings:"SHORTCUT_SETTINGS",support_article:"SUPPORT_ARTICLE",chrome_write_a_review:"CHROME_WRITE_A_REVIEW",edge_write_a_review:"EDGE_WRITE_A_REVIEW",gmail_feedback_survey:"GMAIL_FEEDBACK_SURVEY",gslides_feedback_survey:"GSLIDES_FEEDBACK_SURVEY",firefox_write_a_review:"FIREFOX_WRITE_A_REVIEW",external:{whatsapp:"EXTERNAL_WHATSAPP",twitter:"EXTERNAL_TWITTER",youtube:"EXTERNAL_YOUTUBE",facebook:"EXTERNAL_FACEBOOK",github:"EXTERNAL_GITHUB",discord:"EXTERNAL_DISCORD",telegram:"EXTERNAL_TELEGRAM",reddit:"EXTERNAL_REDDIT",gmail:"EXTERNAL_GMAIL",gdocs:"EXTERNAL_GDOCS",gslides:"EXTERNAL_GSLIDES",linkedIn:"EXTERNAL_LINKEDIN",msOffice:"EXTERNAL_MS_OFFICE"},deepl_support:"DEEPL_SUPPORT",firefox_feedback_survey:"FIREFOX_FEEDBACK_SURVEY",firefox_shortcut_docs:"FIREFOX_SHORTCUT_DOCS"},V={DOCS_GOOGLE_COM_FEEDBACK_FORM:"https://deepl.typeform.com/to/MkMfP2Y6",NEW_FEEDBACK_FORM:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",DEEPL_COM_PRO:"https://www.deepl.com/pro",DEEPL_COM_TRANSLATOR:"https://www.deepl.com/translator",DEEPL_COM_WRITE:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"}.deeplWrite,DEEPL_COM_DOCTRANS:"https://www.deepl.com/translator/files",DEEPL_COM_TERMS_OF_SERVICE_FREE:"https://www.deepl.com/en/pro-license?tab=free",DEEPL_CREATE_ACCOUNT:"https://www.deepl.com/signup",SHORTCUT_SETTINGS:"chrome://extensions/shortcuts",SUPPORT_ARTICLE:"https://support.deepl.com/hc/articles/4407580229522",CHROME_WEBSTORE:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",FIREFOX_WEBSTORE:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",EDGE_WEBSTORE:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",GMAIL_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",GSLIDES_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",EXTERNAL:{WHATSAPP:"https://web.whatsapp.com",TWITTER:"https://www.twitter.com",YOUTUBE:"https://www.youtube.com",FACEBOOK:"https://www.facebook.com",GITHUB:"https://www.github.com",DISCORD:"https://www.discord.com",TELEGRAM:"https://web.telegram.org",REDDIT:"https://www.reddit.com",GMAIL:"https://www.gmail.com",GDOCS:"https://docs.google.com",GSLIDES:"https://slides.google.com",LINKEDIN:"https://www.linkedin.com/",MSOFFICE:"https://www.office.com/"},DEEPL_SUPPORT:"https://support.deepl.com/hc",FIREFOX_FEEDBACK:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",FIREFOX_SHORTCUT_DOCS:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox"};function B(e){const{destination:t,...n}=e;if(void 0!==t)switch(t){case W.share_feedback_survey:return V.DOCS_GOOGLE_COM_FEEDBACK_FORM;case W.new_share_feedback_survey:return V.NEW_FEEDBACK_FORM;case W.try_DeepL_Pro:return n?.utmContent?H(V.DEEPL_COM_PRO,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):V.DEEPL_COM_PRO;case W.show_more_translation:return n?function({sourceLang:e,targetLang:t,textToShare:n}){if(!e||!t||!n)return"";const a=new URL(V.DEEPL_COM_TRANSLATOR);let r=`${e.toLowerCase()}/${t.toLowerCase()}/${encodeURIComponent(n)}`;return a.hash=r,a.href}(n):void console.error("Invalid action.");case W.deepl_translator_home:return n?.utmContent?H(V.DEEPL_COM_TRANSLATOR,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):V.DEEPL_COM_TRANSLATOR;case W.deepl_write_home:return n?.utmContent?H(V.DEEPL_COM_WRITE,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):V.DEEPL_COM_WRITE;case W.deepl_translator_docs:return n?.utmContent?H(V.DEEPL_COM_DOCTRANS,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):V.DEEPL_COM_DOCTRANS;case W.deepl_terms_of_service_free:return V.DEEPL_COM_TERMS_OF_SERVICE_FREE;case W.shortcut_settings:return V.SHORTCUT_SETTINGS;case W.support_article:return V.SUPPORT_ARTICLE;case W.external.whatsapp:return V.EXTERNAL.WHATSAPP;case W.external.twitter:return V.EXTERNAL.TWITTER;case W.external.youtube:return V.EXTERNAL.YOUTUBE;case W.external.facebook:return V.EXTERNAL.FACEBOOK;case W.external.github:return V.EXTERNAL.GITHUB;case W.external.discord:return V.EXTERNAL.DISCORD;case W.external.telegram:return V.EXTERNAL.TELEGRAM;case W.external.reddit:return V.EXTERNAL.REDDIT;case W.external.gmail:return V.EXTERNAL.GMAIL;case W.external.gdocs:return V.EXTERNAL.GDOCS;case W.external.gslides:return V.EXTERNAL.GSLIDES;case W.external.linkedIn:return V.EXTERNAL.LINKEDIN;case W.external.msOffice:return V.EXTERNAL.MSOFFICE;case W.deepl_support:return V.DEEPL_SUPPORT;case W.chrome_write_a_review:return V.CHROME_WEBSTORE;case W.edge_write_a_review:return V.EDGE_WEBSTORE;case W.gmail_feedback_survey:return V.GMAIL_FEEDBACK_SURVEY;case W.gslides_feedback_survey:return V.GSLIDES_FEEDBACK_SURVEY;case W.firefox_write_a_review:return V.FIREFOX_WEBSTORE;case W.firefox_feedback_survey:return V.FIREFOX_FEEDBACK;case W.firefox_shortcut_docs:return V.FIREFOX_SHORTCUT_DOCS;case W.deepl_create_account:return n?.utmContent?H(V.DEEPL_CREATE_ACCOUNT,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):V.DEEPL_CREATE_ACCOUNT;default:return}}function j(e){const t=B(e),{openInSameTab:n}=e;if(!t)return;const a=new URL(t).href;n?chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=e[0];chrome.tabs.update(t.id,{url:a})})):chrome.tabs.create({url:a,active:!0})}function H(e,t){if(0===t.length||!e)return;const n=new URL(e);return t.forEach((e=>{2===e.length&&n.searchParams.append(e[0],e[1])})),n.href}const q=()=>{let e=navigator.languages?navigator.languages[0].substr(0,2).toUpperCase():"EN";var t;e="EN"===(t=e)?"EN-GB":"PT"===t?"PT-PT":t;return o.map((e=>e.langCode)).includes(e)?e:"EN"},X=()=>{const e={};return o.forEach((t=>{let n=t.langCode;["EN-GB","EN-US"].includes(n)&&(n="EN"),["PT-PT","PT-BR"].includes(n)&&(n="PT"),e[n]=0})),e},K=e=>e.substring(0,2).toUpperCase();const Y=e=>{let t=o.find((t=>t.langCode.toUpperCase()===e.toUpperCase()));return t||(t=o.find((t=>t.langCode.substring(0,2).toUpperCase()===e.substring(0,2).toUpperCase())),t)},$=()=>({settingSchemeVersion:3,blacklistDomains:[],blacklistDomainsForReading:[],blacklistDomainsForWriting:[],languagesForTranslation:o.reduce(((e,t)=>({...e,[t.langCode]:s})),{}),selectedTargetLanguage:q(),isTargetLanguageConfirmed:!1,deepLProApiKey:{IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"},APP_VERSION:"1.15.0",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0}}.DEEPL_PRO_API_KEY,installationId:n(),enableFullPageTranslation:!0,enableInputTranslation:!0,enableInlineTranslation:!0,languagePreferenceForWriting:X(),languagePreferenceForReading:X(),blacklistedPopupWidgets:[],successfulTranslations:0,isReviewPopupShown:!1,shouldDisplayFeedbackPopup:!1,isInputHighlighterShown:!1,isInlineHighlighterShown:!1,regionalVariant:void 0,isSurveyLinkHidden:!1,isZendeskOnboarded:!1,isZendeskEnabled:!0,isZendeskOnboardingShown:!1,zendeskFormality:"auto",zendeskSuccessfulTranslations:0,isGDocsOnboardingShown:!1,gDocsSegmentation:G.SENTENCE,isGmailEnabled:!0,wasGmailOnboardingShown:!1,successfulTranslationsGmail:0,wasGmailFeedbackPopupShown:!1,isGSlidesEnabled:!0,isGSlidesOnboardingShown:!1,wasGSlidesFeedbackPopupShown:!1,successfulTranslationsGSlides:0,customizationsActiveStates:{[R.linkedIn]:!0},hasUserSeenAccountCreationNudge:!1,hasUserSeenPostAccountCreationOnboarding:!1}),z={prod:"production",dev:"development",test:"testing"};function Z(){return z.prod}function J(){return Z()===z.dev}function Q(e){chrome.runtime.sendMessage({action:"dlTrackError",errorMessage:e})}const ee={PROTOCOL_ERROR:"PROTOCOL_ERROR",NETWORK_ERROR:"NETWORK_ERROR",FULL_PAGE_SERVER_ERROR:"FULL_PAGE_SERVER_ERROR",USER_UNAUTHORIZED:"-32003",USER_BLOCKED:"429",FORBIDDEN_REQUEST:"403",QUOTA_HAS_BEEN_REACHED:"1045601",TOO_MANY_REQUESTS:"1042902"},te={ENTRY_NOT_FOUND:"ENTRY_NOT_FOUND",SERVER_ERROR:"SERVER_ERROR"},ne="INSTALLATION_ERROR",ae="TRANSLATED_INPUT_NOT_SET",re="FREE_ACCOUNT_LIMIT_EXCEEDED",oe="ANONYMOUS_LIMIT_EXCEEDED";class se extends Error{constructor(e){super(e),this.name=ee.PROTOCOL_ERROR,this.message=e}}class ie extends Error{constructor(e){super(e),this.name=ee.FULL_PAGE_SERVER_ERROR,this.message=e}}class ce extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class le extends Error{constructor(e,t){super(t),this.name=re,this.limit=e,this.message=t}}class de extends Error{constructor(e,t){super(t),this.name=oe,this.limit=e,this.message=t}}class ge extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}function ue(e){try{Q(`${e.name} ${e.message}`),console.error(e.name,e.message)}catch(e){console.error(e)}return{error:e.name}}function pe(){return{url:"https://s.deepl.com/chrome/statistics"}}function he(e){switch(e){case i.manual:return 1;case i.automatic:return 2;case i.inline:return 3;case i.input:return 4;default:return 0}}function me(e){switch(e){case te.ENTRY_NOT_FOUND:return 1;case te.SERVER_ERROR:return 2}}function Ee(e){switch(e){case d.defaultPopup:return g.extensionIcon;case d.fptInjectedPopup:return g.fptAutoInject;default:return 0}}function Te(e){switch(e){case d.defaultPopup:return u.defaultPopup;case d.fptInjectedPopup:return u.injectedFptPopup;case d.inlineTooltipPopup:return u.inlinePopup;default:return 0}}function _e(e){return e===p.hintKeyboardShortcut?1:0}function fe(e){switch(e){case h.inputTranslationTriggerIcon:return 1;case h.inlineTranslationTriggerIcon:return 2;case h.inlineTranslationSettingPopup:return 3;case h.inputTranslationSettingPopup:return 4;case h.settingsPageFPT:return 5;case h.settingsPageReading:return 6;case h.settingsPageWriting:return 7;case h.fptHideModal:return 8;case h.inputTranslationSettingsIcon:return 9;case h.inlineTranslationSettingsIcon:return 10;case h.inputTranslationReadMoreLink:return 11;case h.inlineTranslationReadMoreLink:return 12;case h.fptTranslationReadMoreLink:return 13;case h.extensionHubToggleSwitch:return 14;case h.hubCustomizeShortcut:return 15;case h.hubLoginButton:return 16;case h.hubUpgradeToProLink:return 17;case h.hubTryProLink:return 18;case h.settingsPageCustomizeShortcutButton:return 19;case h.hubFPTEnableCheckbox:return 20;case h.hubFPTDisableCheckbox:return 21;case h.deeplWriteIcon:return 22;case h.hubViewIntegrations:return 23;case h.hubCloseCustomizationsWidget:return 24;case h.gmailOnboardingPopup:return 25;case h.gmailOnboardingIcon:return 26;case h.gmailCharLimitLogin:return 27;case h.gmailFeedbackSurvey:return 28;case h.gslidesFeedbackSurvey:return 29;case h.gslidesCharLimitLogin:return 30;case h.zendeskTryProLink:return 31;case h.settingsPageIntegrations:return 32;case h.onboardingSignUp:return 33;case h.onboardingSkipSignUp:return 34;case h.onboardingLoginLink:return 35;case h.onboardingSeeAllIntegrations:return 36;default:return 0}}function we(e){return e===m.triggerTranslation?1:0}function Ie(e){switch(e){case E.clickOnShortcutNotifiction:return 60011;case E.clickOnInlineTranslationShowAlternatives:return 60026;case E.clickOnInlineTranslationCloseIcon:return 60027;case E.clickOnLogoutMenuEntry:return 60028;default:return 0}}function Le(e){switch(e){case _.inputTranslation:return 1;case _.inlineTranslation:return 2;case _.fullPageTranslation:return 3;default:return 0}}function Se(e){switch(e){case T.disableEverywhere:return 1;case T.disablePerSite:return 2;case T.enableEverywhere:return 3;case T.enablePerSite:return 4;default:return 0}}function ye(e){switch(e){case"top":return f.top;case"right":return f.right;case"bottom":return f.bottom;case"left":return f.left;default:return 0}}function Re(e){switch(e){case W.shortcut_settings:return V.SHORTCUT_SETTINGS;case W.support_article:return V.SUPPORT_ARTICLE;case W.external.whatsapp:return V.EXTERNAL.WHATSAPP;case W.external.twitter:return V.EXTERNAL.TWITTER;case W.external.youtube:return V.EXTERNAL.YOUTUBE;case W.external.facebook:return V.EXTERNAL.FACEBOOK;case W.external.github:return V.EXTERNAL.GITHUB;case W.external.discord:return V.EXTERNAL.DISCORD;case W.external.telegram:return V.EXTERNAL.TELEGRAM;case W.external.reddit:return V.EXTERNAL.REDDIT;case W.external.gmail:return V.EXTERNAL.GMAIL;case W.external.gdocs:return V.EXTERNAL.GDOCS;case W.external.gslides:return V.EXTERNAL.GSLIDES;case W.external.msOffice:return V.EXTERNAL.MSOFFICE;default:return""}}function Ae(e){switch(e){case w.openPage:return 1;case w.backButton:return 2;case w.nextButton:return 3;case w.navigation:return 4;default:return 0}}function Ne(e){switch(e){case L.chrome:return I.chrome;case L.edge:return I.edge;case L.firefox:return I.firefox;case L.local:return I.local;default:return I.unspecified}}function Ce(e){return S[e]||0}function Oe(e){switch(e){case R.default:return 1;case R.gdocs:return 2;case R.whatsappWeb:return 3;case R.twitter:return 4;case R.zendesk:return 5;case R.gmail:return 6;case R.gslides:return 7;case R.linkedIn:return 8;default:return 0}}function be(e){switch(e){case 60026:case 60027:return!0;default:return!1}}function De(e){switch(e){case N.user:return 1;case N.extension:return 2;default:return 0}}function ke(e){switch(e){case O.translation:return 1;case O.login:return 2;default:return 0}}function Pe(e){switch(e){case b.message:return 1;case b.chat:return 2;default:return 0}}function xe(e){switch(e){case D.free:return 1;case D.pro:return 2;case D.none:return 3;default:return 0}}function ve(e){switch(e){case v.READING_VIEW_TRANSLATE:return 1;case v.COMPOSE_VIEW_TRANSLATE:return 2;case v.COMPOSE_VIEW_IMPROVE:return 3;default:return 0}}function Ue(e){switch(e){case U.ANONYMOUS_USER_LIMIT_EXCEEDED:return 1;case U.FREE_ACCOUNT_LIMIT_EXCEEDED:return 2;default:return 0}}function Fe(e){switch(e){case A.translate:return 1;case A.write:return 2;default:return 0}}function Ge(e){switch(e){case F.LOGIN:return 1;case F.SIGNUP:return 2;case F.PRO_TRIAL:return 3;default:return 0}}function Me(e){switch(e){case G.WORD:return 1;case G.SENTENCE:return 2;default:return 0}}function We(e){switch(e){case M.none:return 1;case M.pro:return 2;case M.free:return 3;default:return 0}}const Ve={chrome:"Chrome",edge:"Edge",brave:"Brave",firefox:"Firefox",opera:"Opera",safari:"Safari"};function Be(e,t){let n;try{switch(e){case Ve.chrome:case Ve.brave:n=t.split("Chrome/")[1].split(" ")[0];break;case Ve.edge:n=t.split("Edg/")[1].split(" ")[0];break;case Ve.firefox:n=t.split("Firefox/")[1].split(" ")[0];break;case Ve.opera:n=t.split("OPR/")[1].split(" ")[0];break;case Ve.safari:n=t.split("Version/")[1].split(" ")[0]}}catch(t){console.error(`Could not get the browsers (${e}) version from user agent`,t)}try{!n&&navigator?.userAgentData&&function(e){return e===Ve.chrome||e===Ve.edge||e===Ve.brave||e===Ve.opera}(e)&&(n=je(e).version)}catch(t){console.error(`Could not get the chromium browsers (${e}) version`,t)}return n&&"string"==typeof n?n:"unknown_browser_version"}function je(e){if(!navigator.userAgentData||!e)return;const t=new RegExp(`${e}`,"i");return navigator.userAgentData.brands.filter((e=>t.test(e.brand)))[0]}function He(){const e=navigator?.userAgent||"unknown_user_agent",t=navigator?.userAgentData?.platform||navigator?.platform||"unknown_platform";let n="unknown_browser",a="unknown_browser_version";const r=navigator?.language||"unknown_browser_language";try{const t=e.match(/chrome|chromium|crios/i),r=e.match(/edg/i)||je(Ve.edge),o=e.match(/firefox|fxios/i),s=e.match(/opr\//i)||je(Ve.opera),i=e.match(/safari/i),c=je(Ve.brave);t?(n=Ve.chrome,r&&(n=Ve.edge),s&&(n=Ve.opera),c&&(n=Ve.brave)):r?n=Ve.edge:o?n=Ve.firefox:s?n=Ve.opera:i&&(n=Ve.safari),a=Be(n,e)}catch(e){console.error("Could not get the name of the brower",e)}return{userAgent:e,platform:t,browser:n,browserVersion:a,browserLang:r}}function qe(){if({IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"},APP_VERSION:"1.15.0",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0}}.browserBuild)return{IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"},APP_VERSION:"1.15.0",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0}}.browserBuild.toLowerCase()===Ve.firefox.toLowerCase();const e=chrome.runtime.getURL("");return He().browser===Ve.firefox||/moz-extension:\/\//gm.test(e)}async function Xe(e){let t,n,a,r,o,s,i,l,d=!1;try{const e=await un(["session","installationId"]);n=e.session.id,t=e.installationId}catch(e){console.error(`DAP: Failed to fetch settings. Error: ${e.message}`)}try{const e=await An();d=!!e.accountId,a=xe(e.translatorServiceType),r=xe(e.apiServiceType),o=xe(e.docTranslatorServiceType),i=d?2===a||2===r||2===o?c.loggedInPro:c.loggedInFree:c.notLoggedIn,l=e.sessionType?We(e.sessionType):We(M.none)}catch(e){console.error(`DAP: Failed to fetch user information. Error: ${e.message}`)}try{s=await Cn()}catch(e){console.error(e)}const g=He(),u=await bn(),p={eventId:void 0,extensionVersion:"1.15.0",sessionId:n,sessionType:l,installationId:t,browserInstanceId:s,originStore:Ne(chrome.runtime.id),userInfos:{userType:i,translatorServiceType:a,apiServiceType:r,docTranslatorServiceType:o},userAgent:g.userAgent,platform:g.platform,browser:g.browser,browserVersion:g.browserVersion,browserLang:g.browserLang,clientExperiments:u},h=e?e(p):p;return fetch("https://s.deepl.com/chrome/statistics",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(h)}).then((e=>{e.ok||console.log(`DAP ${h.eventId} request failed: ${e}`)}))}async function Ke(e){return Xe((t=>({...t,eventId:60001,translationRequestData:{extensionVersion:"1.15.0",domainName:e.domainName,userId:e.installationId,translationTrigger:he(e.trigger),translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},...e.translationPerformance&&{translationPerformance:e.translationPerformance},nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function Ye(e){return Xe((t=>({...t,eventId:60002,errorData:{extensionVersion:"1.15.0",errorCode:e.errorCode,errorMessage:e.errorMessage}})))}async function $e(e){return Xe((t=>({...t,eventId:60003,translationErrorData:{errorData:{extensionVersion:"1.15.0",errorCode:e.errorCode,errorMessage:e.errorMessage},targetLang:e.targetLang,domainName:e.domainName,websiteLanguage:e.websiteLanguage,sourceLength:e.characterCount,translationTrigger:he(e.trigger),nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function ze(e){return Xe((t=>({...t,eventId:60004,contentScriptErrorData:{errorData:{extensionVersion:"1.15.0",errorCode:e.errorCode,errorMessage:e.errorMessage},domainName:e.domainName}})))}async function Ze(e){return Xe((t=>({...t,eventId:60005,inputInjectionData:{extensionVersion:"1.15.0",domainName:e.domainName}})))}async function Je(e){return Xe((t=>({...t,eventId:60007,extensionOpenedData:{extensionVersion:"1.15.0",domainName:e.domainName,extensionOpenedFrom:e.extensionOpenedFrom}})))}async function Qe(e){return Xe((t=>({...t,eventId:60008,logoClickedData:{extensionVersion:"1.15.0",logoClickedFrom:e.logoClickedFrom}})))}async function et(e){return Xe((t=>({...t,eventId:60009,notificationViewedData:{extensionVersion:"1.15.0",notificationType:_e(e.notificationType)}})))}async function tt(e){return Xe((t=>({...t,eventId:60010,shortcutUsedData:{shortcutType:we(e.shortcutType),uiLocation:fe(e.location),shortcut:e.shortcut,nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function nt(e){const t={eventId:Ie(e.uiAction)};return be(t.eventId)&&(t.payload={nicheIntegration:Oe(e.nicheIntegration||R.default)}),Xe((e=>({...e,...t})))}async function at(){return Xe((e=>({...e,eventId:60012})))}async function rt(){return Xe((e=>({...e,eventId:60013})))}async function ot(e){return Xe((t=>({...t,eventId:60014,inlineSettingOpenedData:{uiFunction:Le(e.uiFunction),uiLocation:fe(e.uiLocation),nicheIntegration:Oe(e.nicheIntegration)}})))}async function st(e){return Xe((t=>({...t,eventId:60015,settingChangedData:{settingType:Se(e.settingType),uiFunction:Le(e.uiFunction),uiLocation:fe(e.uiLocation),domainName:e.domainName}})))}async function it(e){return Xe((t=>({...t,eventId:60016,detectLanguageData:{domainName:e.domainName,language:e.language}})))}async function ct(e){return Xe((t=>({...t,eventId:60017,rightClickData:{domainName:e.domainName,translationType:e.translationType}})))}async function lt(e){return Xe((t=>({...t,eventId:60018,inlinePositionChangeData:{newPosition:ye(e.newPosition)}})))}async function dt(e){return Xe((t=>({...t,eventId:60019,inlineDragStartData:{nicheIntegration:Oe(e?.nicheIntegration||R.default)}})))}async function gt(e){return Xe((t=>({...t,eventId:60020,whatsAppMessageTranslatedData:{messageLang:e.messageLang,targetLang:e.targetLang,messageLength:e.messageLength,translator:Pe(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}})))}async function ut(e){return Xe((t=>({...t,eventId:60021,whatsAppMessageTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang,translator:Pe(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}}})))}async function pt(e){return Xe((t=>({...t,eventId:60057,twitterTweetTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang}}})))}async function ht(e){return Xe((t=>({...t,eventId:60022,fptHideData:{hideOption:e.hideOption,sourceLang:e.sourceLang,domainName:e.domainName,uiLocation:fe(e.uiLocation)}})))}async function mt(e){return Xe((t=>({...t,eventId:60023,inlineCopyData:{targetLang:e.targetLang,targetLength:e.targetLength,nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function Et(e){return Xe((t=>({...t,eventId:60024,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,actionType:e.actionType,nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function Tt(e){return Xe((t=>({...t,eventId:60025,iconHoverData:{uiLocation:fe(e.uiLocation),domainName:e.domainName,nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function _t(e){return Xe((t=>({...t,eventId:60029,onboardingStepChangeData:{previousStep:e.previousStep,newStep:e.newStep,trigger:Ae(e.trigger),secondsOnOnboarding:e.secondsOnOnboarding,secondsOnPreviousStep:e.secondsOnPreviousStep}})))}async function ft(e){return Xe((t=>({...t,eventId:60030,onboardingOpenExternalPageData:{url:Re(e.url)}})))}async function wt(e){return Xe((t=>({...t,eventId:60031,readMoreClickedData:{uiLocation:fe(e.uiLocation)}})))}async function It(e){return Xe((t=>({...t,eventId:60032,landOnWebsiteData:{website:Ce(e.website)}})))}async function Lt(e){return Xe((t=>({...t,eventId:60033,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,triggerType:e.triggerType,nicheIntegration:Oe(e.nicheIntegration||R.default)}})))}async function St(e){return Xe((t=>({...t,eventId:60034,openInputHighlighterData:{domainName:e.domainName}})))}async function yt(e){return Xe((t=>({...t,eventId:60035,closeInputHighlighterData:{trigger:e.trigger}})))}async function Rt(e){return Xe((t=>({...t,eventId:60036,gdocsReplaceTextData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength,targetLength:e.targetLength}})))}async function At(){return Xe((e=>({...e,eventId:60037})))}async function Nt(e){return Xe((t=>({...t,eventId:60038,openInputHighlighterData:{domainName:e.domainName}})))}async function Ct(e){return Xe((t=>({...t,eventId:60039,closeInputHighlighterData:{trigger:e.trigger}})))}async function Ot(e){return Xe((t=>({...t,eventId:60040,dictionaryStatus:{status:e.status,langPair:e.langPair}})))}async function bt(){return Xe((e=>({...e,eventId:60041})))}async function Dt(){return Xe((e=>({...e,eventId:60042})))}async function kt(e){return Xe((t=>({...t,eventId:60043,errorData:{lingueeError:me(e.error)}})))}async function Pt(e,t){let n;switch(e){case C.OPEN_TICKET:n=60044;break;case C.DETECT_TICKET_LANGUAGE:n=60045;break;case C.SWITCH_TICKET_LANGUAGE:n=60046;break;case C.ENABLE_AUTOTRANSLATE:n=60047;break;case C.DISABLE_AUTOTRANSLATE:n=60048;break;case C.TRANSLATE_MESSAGE:n=60049;break;case C.TRANSLATE_INPUT:n=60050;break;case C.ERROR:n=60051;break;default:return}return Xe((e=>({...e,eventId:n,zendeskMetaData:{agentLanguage:t.agentLanguage,ticketLanguage:t.ticketLanguage,isTicketLanguageAutodetected:t.isTicketLanguageAutodetected,isTicketLanguageSupported:t.isTicketLanguageSupported,isAutoTranslateEnabled:t.isAutoTranslateEnabled,sourceTextLength:t.sourceTextLength,targetTextLength:t.targetTextLength,inputHasSelection:t.inputHasSelection,error:t.error}})))}async function xt(){return Xe((e=>({...e,eventId:60054})))}async function vt(e){const t=Math.round(await yn()/60);return Xe((n=>({...n,eventId:60055,logoutData:{trigger:De(e.trigger),minutesSinceLastLogin:t,reason:e.reason}})))}async function Ut(e){return Xe((t=>({...t,eventId:60052,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function Ft(e){return Xe((t=>({...t,eventId:60053,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function Gt(e){return Xe((t=>({...t,eventId:60056,sessionTypeData:{sessionType:e.sessionType,trigger:ke(e.trigger)}})))}async function Mt(e){let t="";try{t=await wn()}catch(e){console.log(`DAP: Failed to fetch session type. Error: ${e.message}`)}return Xe((n=>({...n,eventId:60058,onboardingModalShownData:{nicheIntegration:Oe(e.nicheIntegration||R.default),sessionType:t}})))}async function Wt(e){return Xe((t=>({...t,eventId:60059,UILocationClickedData:{target:fe(e)}})))}async function Vt(){return Xe((e=>({...e,eventId:60060})))}async function Bt(){return Xe((e=>({...e,eventId:60061})))}async function jt(e,t){let n;switch(e){case k.TEXT_REFINEMENT_REQUEST:n=60062;break;case k.GDOCS_INSERT_COPY:n=60063;break;case k.GDOCS_DISCARD_COPY:n=60064;break;case k.GDOCS_CHAR_LIMIT_REACHED:n=60065;break;case k.ERROR:n=60066;break;case k.RESULT_ACCEPTED:n=60071;break;case k.RESULT_REVERTED:n=60072;break;default:return}return Xe((e=>({...e,eventId:n,deeplWriteMetaData:{lang:t.lang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:Oe(t.nicheIntegration||R.default),error:t.error}})))}async function Ht(){if(!await _n())return;const e=await On();return Xe((t=>({...t,eventId:60067,accountData:{accountUuid:e}})))}async function qt(){const e=await On();return Xe((t=>({...t,eventId:60068,accountData:{accountUuid:e}})))}async function Xt(){const e=await On();return Xe((t=>({...t,eventId:60069,accountData:{accountUuid:e}})))}async function Kt(e,t){let n;switch(e){case P.RESULT_ACCEPTED:n=60073;break;case P.RESULT_REVERTED:n=60074;break;default:return}return Xe((e=>({...e,eventId:n,translationResultActionData:{sourceLang:t.sourceLang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:Oe(t.nicheIntegration||R.default),error:t.error}})))}async function Yt(e){return Xe((t=>({...t,eventId:60070,customizationOnOffData:{nicheIntegration:Oe(e.nicheIntegration||R.default),uiLocation:fe(e.location),customizationEnabled:e.customizationEnabled}})))}async function $t(e){return Xe((t=>({...t,eventId:60075,gmailCharLimitReachedData:{gmailActionType:ve(e.type)}})))}async function zt(e){return Xe((t=>({...t,eventId:60076,upgradeNotificationDisplayedData:{type:Ue(e)}})))}async function Zt(e){return Xe((t=>({...t,eventId:60077,upgradeNotificationClosedData:{type:Ue(e)}})))}async function Jt(e,t){return Xe((n=>({...n,eventId:60078,upgradeNotificationActionData:{type:Ue(e),action:Ge(t)}})))}async function Qt(e,t){let n;switch(e){case x.ALTERNATIVES_OPENED:n=60079;break;case x.SEGMENTATION_SELECTED:n=60080;break;case x.ALTERNATIVE_SELECTED:n=80081;break;default:return}return Xe((e=>({...e,eventId:n,alternativesMetaData:{sourceLang:t.sourceLang,targetLang:t.targetLang,nicheIntegration:Oe(t.nicheIntegration||R.default),contentProcessingMode:Fe(t.contentProcessingMode),...t.alternativesSegmentation&&{alternativesSegmentation:Me(t.alternativesSegmentation)}}})))}let en;const tn="dlBrowserExtension",nn="dlCache";function an(){return new Promise(((e,t)=>{let n=indexedDB.open(tn,1);n.onerror=function(){t("Error creating database.")},n.onsuccess=function(t){en=t.target.result,e()},n.onupgradeneeded=function(t){en=t.target.result,en.objectStoreNames.contains(nn)||en.createObjectStore(nn,{keyPath:"id"}),e()}}))}async function rn(e,t,n){return en||await an(),new Promise(((a,r)=>{let o=en.transaction(n,"readwrite").objectStore(n).put({id:e,data:t,meta:{createdAt:Date.now()}});o.onsuccess=function(){a()},o.onerror=function(e){r(e)}}))}async function on(e,t){return en||await an(),new Promise(((n,a)=>{let r=en.transaction(t,"readonly").objectStore(t).get(e);r.onerror=function(e){a(e)},r.onsuccess=function(){r.result?n(r.result):n(null)}}))}function sn(e){return rn("dlclientstate",e,nn)}async function cn(){const e=await on("dlclientstate",nn);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>20?void 0:e.data}function ln(e){return rn("dlexperiments",e,nn)}async function dn(){try{const e=await on("dlexperiments",nn);return e&&e.meta&&e.data?e.data:[]}catch(e){return[]}}async function gn(){const e=await on("dlexperiments",nn);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>9||!e.data||0===e.data.length?void 0:e.data}async function un(e){if(e.includes("session")){const e=await chrome.storage.sync.get(["session"]);e&&!e.session&&await pn()}return new Promise(((t,n)=>{chrome.storage.sync.get(e,(a=>{a?t(a):n(`Can not get ${e}`)}))}))}async function pn(){const e=n();await chrome.storage.sync.set({session:{id:e,timestamp:Date.now()}});try{await Ht()}catch(e){console.error(e)}}async function hn(){const{session:e}=await un(["session"]);!e||(Date.now()-e.timestamp)/6e4>30?await pn():await chrome.storage.sync.set({session:{...e,timestamp:Date.now()}})}async function mn(e,t,n){const a=r(e);return await chrome.storage.local.set({a_t:e,r_t:t,i_t:n,isLoggedIn:!(!e||!t),isProUser:!(!a||"Pro"!==a.sessionType),sessionType:a?.sessionType}),a?.sessionType}async function En(){await chrome.storage.local.remove(["a_t","r_t","i_t"]),await chrome.storage.local.set({isLoggedIn:!1,isProUser:!1,sessionType:""})}async function Tn(){const e=await chrome.storage.local.get(["a_t","r_t","i_t"]);return{access_token:e?e.a_t:void 0,refresh_token:e?e.r_t:void 0,id_token:e?e.i_t:void 0}}async function _n(){const e=await chrome.storage.local.get(["isLoggedIn"]);return!(!e||!e.isLoggedIn)}async function fn(){const e=await chrome.storage.local.get(["isProUser"]);return!(!e||!e.isProUser)}async function wn(){const e=await chrome.storage.local.get(["sessionType"]);return e?.sessionType}async function In(){return(await chrome.storage.sync.get(["installationId"])).installationId}async function Ln(){await chrome.storage.local.set({last_login:Date.now()})}async function Sn(){await chrome.storage.local.remove(["last_login"])}async function yn(){const e=await chrome.storage.local.get(["last_login"]);return e&&e.last_login?(Date.now()-e.last_login)/1e3:0}async function Rn(e){const t=e.featureSet.translator.service,n=e.featureSet.api.service,a=e.featureSet.documentTranslation.service;let r,o;e.loginState?.accountId&&(r=e.loginState.accountId),e.featureSet?.integrations?.browserExtension&&(o=e.featureSet?.integrations?.browserExtension),await chrome.storage.local.set({translatorServiceType:t,apiServiceType:n,docTranslatorServiceType:a,accountId:r||"",featureSet:o})}async function An(){return await chrome.storage.local.get(["isLoggedIn","isProUser","sessionType","translatorServiceType","apiServiceType","docTranslatorServiceType","accountId"])}async function Nn(){await chrome.storage.local.set({browserInstanceId:n()})}async function Cn(){return(await chrome.storage.local.get(["browserInstanceId"])).browserInstanceId}async function On(){const e=await chrome.storage.local.get(["accountId","a_t","i_t"]);if(e&&e.accountId)return e.accountId;if(e&&e.a_t){const t=r(e.a_t),n=r(e.i_t);return t.sub||n.sub}}async function bn(){let e=[];try{e=await dn()}catch(e){}if(!e||0===e.length)return[];return e.map((e=>({id:e.id,variant:e.variant,breakout:e.breakout})))}async function Dn(e="translatorServiceType"){const t=await An(),n=!!t.accountId,a=t[e];return n?a===D.pro?c.loggedInPro:c.loggedInFree:c.notLoggedIn}async function kn(e="translatorServiceType"){switch(await Dn(e)){case c.loggedInFree:return l.loggedInFree;case c.loggedInPro:return;case c.notLoggedIn:default:return l.notLoggedIn}}async function Pn(e=!1){if(!e){let e;try{e=await gn()}catch(e){}if(e)return e}const t=await In();if(!t)throw new Error("Installtion ID is not valid");let n=[];try{n=await dn()}catch(e){}const a=`https://s.deepl.com/chrome/experiments/${t}`;let r;try{const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(n)});if(r=(await e.json()).client_experiments,!r)return n;try{ln(r)}catch(e){}return r}catch(e){return n}}const xn={ACCESS_DENIED:"ACCESS_DENIED",INVALID_REQUEST:"INVALID_REQUEST",INVALID_GRANT:"INVALID_GRANT",GET_TOKEN_ERROR:"GET_TOKEN_ERROR",INVALID_NONCE:"INVALID_NONCE"};class vn extends Error{constructor(e,t){super(e),this.name=xn.ACCESS_DENIED,this.message=e,this.httpStatusCode=t}}class Un extends Error{constructor(e,t){super(e),this.name=xn.INVALID_REQUEST,this.message=e,this.httpStatusCode=t}}class Fn extends Error{constructor(e,t){super(e),this.name=xn.INVALID_GRANT,this.message=e,this.httpStatusCode=t}}class Gn extends Error{constructor(e,t){super(e),this.name=xn.GET_TOKEN_ERROR,this.message=e,this.httpStatusCode=t}}class Mn extends Error{constructor(e){super(e),this.name=xn.INVALID_NONCE,this.message=e}}function Wn(e,t){const n=e.split("?")[1];if(n){var a=n.split("&");for(let e=0;e<a.length;e++){const n=a[e].split("=");if(decodeURIComponent(n[0])===t)return decodeURIComponent(n[1])}}}async function Vn(e,t,n="https://test.deepl.com/oidc-login"){const r=a(),o=a(),s=await async function(e){const t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(o);return{url:n+"?"+new URLSearchParams([["client_id",e],["redirect_uri",t],["code_challenge",s],["code_challenge_method","S256"],["nonce",r]]),nonce:r,codeVerifier:o}}function Bn(e,t){if(200!==e){if("invalid_request"===t.error)throw new Un(`dl-oidc (get tokens): invalid request - http status: ${e}`,e);if("invalid_grant"===t.error)throw new Fn(`dl-oidc (get tokens): invalid grant - http status: ${e}`,e);throw new Gn(`dl-oidc (get tokens): http status: ${e}`,e)}}async function jn(e,t="https://deepl.com/oidc/token"){const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})}),a=await n.json();return Bn(n.status,a),a.access_token}async function Hn(e,t,n=!1){let a=t.access_token;async function r(){return await fetch(e,{...t,headers:{...t.headers,Authorization:a?`Bearer ${a}`:"None"}})}n&&a&&(a=await jn(t.refresh_token,t.token_url));let o=await r();return 401!==o.status&&403!==o.status||(a=await jn(t.refresh_token,t.token_url),o=await r()),{response:o,accessToken:a}}function qn(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}async function Xn(e=!1,n=!0){if(!e){const e=await cn();if(e)return e}const a=qn("getClientState",{v:"20180814"},t()),o=await Tn(),s=n||function(e){try{const t=r(e);if(t.exp&&Date.now()/1e3<t.exp-5)return!1}catch(e){console.error("Error decoding token:",e)}return!0}(o.access_token),{response:i,accessToken:c}=await Hn("https://w.deepl.com/web",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(a),access_token:o.access_token,refresh_token:o.refresh_token,token_url:"https://w.deepl.com/oidc/token"},s);await mn(c,o.refresh_token,o.id_token);const l=(await i.json()).result;return l&&(sn(l),Rn(l)),l}async function Kn(e=!1){const t=async()=>{const t=await Vn("chromeExtension",chrome.identity.getRedirectURL(),"https://www.deepl.com/auth/login");return new Promise(((n,a)=>{chrome.identity.launchWebAuthFlow({interactive:!0,url:e?`${t.url}#error_loginfailed`:t.url},(async e=>{if(!e){const e=chrome.runtime.lastError.message;return console.error("response url undefined",e),Q(`login - response url undefined. ${e}`),/The user did not approve access/gm.test(e)||/User cancelled or denied access/gm.test(e)?n():a()}try{const a=await async function(e,t,n,a,o,s="https://deepl.com/oidc/token"){const i=Wn(n,"code");if(!i){const e=Wn(n,"error");if("access_denied"===e)throw new vn("dl-oidc (get tokens): access denied - undefined code");if("invalid_request"===e)throw new Un("dl-oidc (get tokens): invalid request - undefined code")}const c=await fetch(`${s}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:e,code_verifier:o,code:i,grant_type:"authorization_code",redirect_uri:t})}),l=await c.json();if(Bn(c.status,l),r(l.id_token).nonce!==a)throw new Mn("dl-oidc (get tokens): invalid nonce");return l}("chromeExtension",chrome.identity.getRedirectURL(),e,t.nonce,t.codeVerifier,"https://w.deepl.com/oidc/token"),o=await mn(a.access_token,a.refresh_token,a.id_token);try{await Xn(!0,!1),xt(),qt(),o&&await Gt({sessionType:o,trigger:"LOGIN"})}catch(e){console.error(e)}await Ln(),n()}catch(e){console.error(e);try{Ye({errorCode:e.name,errorMessage:e.message})}catch(e){console.error(e)}a(e)}}))}))};try{await t()}catch(e){Kn(!0)}}async function Yn(e){const t=await Tn(),n=`https://www.deepl.com/auth/logout?${new URLSearchParams([["id_token_hint",t.id_token],["post_logout_redirect_uri",chrome.identity.getRedirectURL()]])}`;chrome.identity.launchWebAuthFlow({url:n,interactive:!0},(async()=>{await Sn();try{await Xt()}catch(e){console.error(e)}await En();try{await vt({trigger:e.trigger,reason:e.reason})}catch(e){console.error(e)}await Xn(!0),e.showAlert&&chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlShowAlert",payload:{error:e.reason}})}))}))}async function $n(e,t,n,a){const r=await Tn(),o=await fn();let s=r&&r.access_token&&o?"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0":"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0";a&&(s=r&&r.access_token&&o?"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0":"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0");try{const{response:a,accessToken:o}=await Hn(s,{method:"POST",headers:{"Content-Type":t},body:e,access_token:r.access_token,refresh_token:r.refresh_token,token_url:"https://w.deepl.com/oidc/token"}),i=await mn(o,r.refresh_token,r.id_token);if(i)try{await Gt({sessionType:i,trigger:"TRANSLATION"})}catch(e){console.log(e)}try{await Xn(!1,!1)}catch(e){console.error(`Failed to get the client state ${e.message}`)}let c=function(e,t,n){let a;try{a=JSON.parse(e)}catch(e){throw 200===t?new se("JSON_RPC: Parsing of response object failed"):t>=500&&n?new ie(`FPT failed: Http status code ${t}`):new ce(t.toString(),403===t?`Translation failed: Http status code ${t} forbidden request. re-authenticating makes no difference.`:`Translation failed: Http status code ${t}`)}if("2.0"!==a.jsonrpc||void 0!==a.result&&200!==t||void 0===a.result&&void 0===a.error)throw new se("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(a.error){const e=a.error;if(void 0===e.code)throw new se('JSON_RPC: Missing field "code" in error response');throw new ce(e.code.toString(),e.message)}if(200!==t)throw new ce(t.toString(),`Http status code ${t}`);return a}(await a.text(),a.status,n);return{data:c,status:a.status}}catch(e){throw e.name!==xn.ACCESS_DENIED&&e.name!==xn.INVALID_REQUEST&&e.name!==xn.INVALID_GRANT&&e.name!==ee.USER_UNAUTHORIZED&&e.name!==ee.FORBIDDEN_REQUEST||setTimeout((()=>{Yn({trigger:N.extension,reason:e.name})}),5e3),e}}async function zn(e,t,n=(e=>e),a,r,o){const s=function(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}(e,t,a),i=n(JSON.stringify(s),s);return(await $n(i,"application/json; charset=utf-8",r,o)).data.result}async function Zn(e){let t,n={};for(const t in e.weights)e.weights[t]>0&&(n[t]=e.weights[t]);try{t=await Dn()}catch(e){t=c.notLoggedIn,console.log(e)}if(t!==c.loggedInPro&&e.nicheIntegration===R.default){const n=e.sourceTexts.reduce(((e,t)=>e+t.length),0),a=await kn();if(t===c.loggedInFree&&n>a)throw new le(a,"Limit exceeded (free account). Please upgrade");if(t===c.notLoggedIn&&n>a)throw new de(a,"Limit exceeded (anonymous user). Please upgrade")}let a=e.sourceTexts;const r=["EN-US","EN-GB","PT-PT","PT-BR"].includes(e.targetLangCode?.toUpperCase());let o=e.targetLangCode?.toUpperCase();r&&(o=e.targetLangCode?.toUpperCase().slice(0,2));const s={texts:e.isWriteRequest?e.sourceTexts.map((e=>({text:e,requestAlternatives:4}))):a.map((e=>({text:e}))),...e.isHtml&&{html:"enabled"},...!e.isHtml&&{splitting:e.splitting?e.splitting:"paragraphs"},lang:{target_lang:o,source_lang_user_selected:"auto"===e.sourceLang?"auto":e.sourceLang.toUpperCase(),preference:{weight:n}},commonJobParams:{regionalVariant:e.regionalVariant&&r?e.regionalVariant:void 0,...e.isWriteRequest&&{mode:"write"},...e.formality&&{formality:e.formality}}};let i=1;const l=Date.now();a.forEach((e=>i+=(e.match(/[i]/g)||[]).length)),s.timestamp=l-l%i+i;const d=await zn("LMT_handle_texts",s,((e,t)=>e=(t.id+3)%13==0||(t.id+5)%29==0?e.replace('"method":"','"method" : "'):e.replace('"method":"','"method": "')),e.id,e.isHtml,e.isWriteRequest);return{texts:d.texts.map((e=>e.text)),sourceLang:d.lang.toUpperCase(),detectedLanguages:d.detectedLanguages}}const Jn=new Map([["ZH_EN","chinese-english"],["EN_ZH","english-chinese"],["NL_EN","dutch-english"],["EN_NL","english-dutch"],["FR_EN","french-english"],["EN_FR","english-french"],["FR_DE","french-german"],["DE_FR","german-french"],["FR_PT","french-portuguese"],["PT_FR","portuguese-french"],["FR_ES","french-spanish"],["ES_FR","spanish-french"],["DE_EN","german-english"],["EN_DE","english-german"],["DE_PT","german-portuguese"],["PT_DE","portuguese-german"],["DE_ES","german-spanish"],["ES_DE","spanish-german"],["IT_EN","italian-english"],["EN_IT","english-italian"],["JA_EN","japanese-english"],["EN_JA","english-japanese"],["PL_EN","polish-english"],["EN_PL","english-polish"],["PT_EN","portuguese-english"],["EN_PT","english-portuguese"],["PT_ES","portuguese-spanish"],["ES_PT","spanish-portuguese"],["RU_EN","russian-english"],["EN_RU","english-russian"],["ES_EN","spanish-english"],["EN_ES","english-spanish"]]);async function Qn(e){const t=function(e,t){const n=`${e.toUpperCase()}_${t.toUpperCase()}`;return Jn.get(n)}(ea(e.sourceLang),ea(e.targetLang)),n=encodeURIComponent(e.text),a=`https://www-app.linguee.com/${t}/search?dlApp=BrowserExtension&il=${e.interfaceLang}&query=${n}`;let r=async function(e){let t;if(200!==e.status)throw 404===e.status?(console.error("Dictionary Entry not found: 404"),new ge(te.ENTRY_NOT_FOUND)):(console.error("Dictionary Server Error"),new ge(te.SERVER_ERROR));{try{t=await e.text()}catch(e){throw new ge(te.SERVER_ERROR)}const n=/href=["']([^"']*)["']/g;t=t.replace(n,"")}return t}(await fetch(a));return r}function ea(e){return["EN-US","EN-GB","PT-PT","PT-BR"].includes(e)?["EN-US","EN-GB"].includes(e)?"EN":["PT-PT","PT-BR"].includes(e)?"PT":e:e}function ta(e,t){const n=1e-5;return n*Math.floor((.97*e+t)/n)}const na="PROTOCOL_ERROR",aa="FULL_PAGE_SERVER_ERROR",ra="-32003",oa="403";class sa extends Error{constructor(e){super(e),this.name=na,this.message=e}}class ia extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class ca extends Error{constructor(e){super(e),this.name=aa,this.message=e}}function la(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function da(e,t){return{jsonrpc:"2.0",method:e,params:t,id:la()}}const ga={TRANSLATE:"translate",WRITE:"write"},ua="LMT_split_text",pa="LMT_handle_jobs";const ha=async({mode:e,texts:t,config:n,sourceLang:a="auto"})=>{const r=`${await Ta(n,e)}&method=${ua}`,o=da(ua,{commonJobParams:{mode:e},lang:{lang_user_selected:a},texts:t});return await Ea(r,{method:"POST",headers:{"Content-Type":"application/json"},body:fa(o)},n)},ma=async({mode:e,jobs:t,sourceLang:n,targetLang:a,config:r})=>{const o=`${await Ta(r,e)}&method=${pa}`,s=da(pa,{commonJobParams:{mode:e},lang:{source_lang_computed:n,target_lang:a},jobs:t,priority:1,timestamp:_a(t)});return await Ea(o,{method:"POST",headers:{"Content-Type":"application/json"},body:fa(s)},r)},Ea=async(e,t,n)=>{const a=await n.auth.getAuthTokens(),r=a?{access_token:a.access_token,refresh_token:a.refresh_token,token_url:n.auth.tokenUrl}:{},{response:o,accessToken:s}=await Hn(e,{...t,...r});return await n.auth.setAuthTokens(s,a.refresh_token,a.id_token),await wa({response:o,isHtml:!1})},Ta=async({auth:e,baseUrls:t},n)=>{const a=await e.getAuthTokens(),r=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}})(a.access_token),o=r&&"Pro"===r.sessionType,s=n===ga.WRITE?t.write:t.translate;return a.access_token&&o?s.pro:s.free},_a=e=>{const t=e.reduce(((e,t)=>[...e,...t.sentences.map((e=>e.text))]),[]);let n=1;const a=Date.now();return t.forEach((e=>n+=(e.match(/[i]/g)||[]).length)),a-a%n+n},fa=e=>{let t=JSON.stringify(e);return t=(e.id+3)%13==0||(e.id+5)%29==0?t.replace('"method":"','"method" : "'):t.replace('"method":"','"method": "'),t},wa=async({response:e,isHtml:t})=>{let n;try{if(403===e.status)throw new ia(e.status.toString(),`Translation failed: Http status code ${e.status} forbidden request. re-authenticating makes no difference.`);n=JSON.parse(await e.text())}catch(n){throw 200===e.status?new sa("JSON_RPC: Parsing of response object failed"):e.status>=500&&t?new ca(`FPT failed: Http status code ${e.status}`):new ia(e.status.toString(),`Translation failed: Http status code ${e.status}`)}if("2.0"!==n.jsonrpc||void 0!==n.result&&200!==e.status||void 0===n.result&&void 0===n.error)throw new sa("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(n.error){if(void 0===n.error.code)throw new sa('JSON_RPC: Missing field "code" in error response');throw new ia(n.error.code.toString(),n.error.message)}if(200!==e.status)throw new ia(e.status.toString(),`Http status code ${e.status}`);return n},Ia=ga;async function La({texts:e,mode:t=ga.TRANSLATE,targetLang:n}){return Ra((async a=>await async function({texts:e,mode:t=ga.TRANSLATE,targetLang:n,config:a}){const r=await ha({mode:t,texts:e,config:a}),o=r.result.texts[0].chunks.map(((e,n,a)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:n<a.length-1&&a.length>1?[a[n+1].sentences[0].text]:[],raw_en_context_before:n>0?[a[n-1].sentences[0].text]:[],sentences:[{...e.sentences[0],id:n}],...t===ga.WRITE&&{write_variant_requests:["main","variants"]}})));return await ma({mode:t,jobs:o,sourceLang:r.result.lang.detected,targetLang:t===ga.WRITE?r.result.lang.detected:n,config:a})}({texts:e,mode:t,targetLang:n,config:a})))}const Sa=async({mode:e,texts:t,sourceLang:n="auto"})=>Ra((async a=>await ha({mode:e,texts:t,sourceLang:n,config:a}))),ya=async({mode:e,jobs:t,sourceLang:n,targetLang:a})=>Ra((async r=>await ma({mode:e,jobs:t,sourceLang:n,targetLang:a,config:r}))),Ra=async e=>{try{return await e(Aa())}catch(e){throw e.name!==xn.ACCESS_DENIED&&e.name!==xn.INVALID_REQUEST&&e.name!==xn.INVALID_GRANT&&e.name!==ra&&e.name!==oa||setTimeout((()=>{Yn({trigger:N.extension,reason:e.name})}),5e3),e}},Aa=()=>({baseUrls:{translate:{free:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.15.0",pro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.15.0"},write:{free:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0",pro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.15.0"}},auth:{getAuthTokens:Tn,setAuthTokens:mn,tokenUrl:"https://w.deepl.com/oidc/token"}});async function Na(e){const t=await un(["selectedTargetLanguage"]);chrome.tabs.sendMessage(e,{action:"dlTranslateInline",targetLang:t.selectedTargetLanguage})}async function Ca(e){await hn();const n=await un(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=new Date,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),isHtml:!0,sourceTexts:e.payload.texts,regionalVariant:n.regionalVariant};let o;try{o=await Zn(r)}catch(t){try{$e({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.sourceLang,trigger:e.payload.trigger,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0)})}catch(e){console.log(e)}throw t}fr();const s={isFirstTime:e.payload.isFirstTime,processingTimeInMs:new Date-a};try{Ke({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:n.selectedTargetLanguage,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0),translationPerformance:s,domainName:e.payload.domainName})}catch(e){console.error(e)}return o.texts}async function Oa(e){await hn();const n=await un(["selectedTargetLanguage","session","installationId","languagePreferenceForReading","regionalVariant"]),a=e.payload.nicheIntegration||R.default,r={sourceLang:e.payload.sourceLang||"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:e.payload.requests.map((e=>e.text)),weights:n.languagePreferenceForReading,splitting:"newlines",regionalVariant:n.regionalVariant,nicheIntegration:a,isWriteRequest:e.payload.isWriteRequest};let o;try{o=await Zn(r)}catch(t){try{e.payload.isWriteRequest?jt(k.ERROR,{lang:e.payload.websiteLanguage,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:0,nicheIntegration:a,error:t.name}):$e({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.websiteLanguage,trigger:e.payload.trigger,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}fr(),e.payload.platformBehavior===R.gslides&&jr();try{if(o.detectedLanguages){for(const e in o.detectedLanguages)(n.languagePreferenceForReading[e]||0===n.languagePreferenceForReading[e])&&(n.languagePreferenceForReading[e]=ta(n.languagePreferenceForReading[e],o.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForReading:n.languagePreferenceForReading})}}catch(e){console.error(e)}try{e.payload.isWriteRequest?jt(k.TEXT_REFINEMENT_REQUEST,{lang:e.payload.sourceLang,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:o.texts.reduce(((e,t)=>e+t.length),0),nicheIntegration:a}):Ke({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:o.sourceLang,targetLanguage:n.selectedTargetLanguage,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:a})}catch(e){console.error(e)}return o.texts.map((e=>({text:e,detected_source_language:o.sourceLang})))}async function ba(e){await hn();const n=await un(["targetLanguageUserInput","session","installationId","languagePreferenceForWriting","regionalVariant"]),a=e.payload.requests,r=e.payload.targetLang||n.targetLanguageUserInput,o=e.payload.platformBehavior||R.default,s={sourceLang:"auto",targetLangCode:r,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],weights:n.languagePreferenceForWriting,splitting:"paragraphs",regionalVariant:n.regionalVariant,nicheIntegration:o,...e.payload.isHtml&&{isHtml:e.payload.isHtml},...e.payload.formality&&{formality:e.payload.formality},...e.payload.isWriteRequest&&{isWriteRequest:e.payload.isWriteRequest}};let c;try{c=await Zn(s)}catch(t){try{e.payload.isWriteRequest?jt(k.ERROR,{lang:e.payload.sourceLang,sourceLength:a.reduce(((e,t)=>e+t.text.length),0),targetLength:0,nicheIntegration:o,error:t.name}):$e({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:r,websiteLanguage:e.payload.websiteLanguage,trigger:i.input,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}if(fr(),e.payload.platformBehavior===R.gmail?Vr():e.payload.platformBehavior===R.gslides&&jr(),c.sourceLang===n.targetLanguageUserInput&&a[0].text.length>15){let e;if("EN"===r)e="DE";else e="EN";let n=await Zn({...s,targetLangCode:e,id:t()});const a=await Zn({...s,sourceTexts:n.texts,id:t()});c.texts=a.texts}try{if(c.detectedLanguages){for(const e in c.detectedLanguages)(n.languagePreferenceForWriting[e]||0===n.languagePreferenceForWriting[e])&&(n.languagePreferenceForWriting[e]=ta(n.languagePreferenceForWriting[e],c.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForWriting:n.languagePreferenceForWriting})}}catch(e){console.error(e)}if(!0!==e.payload.skipDapReporting)try{e.payload.isWriteRequest?jt(k.TEXT_REFINEMENT_REQUEST,{lang:e.payload.sourceLang,sourceLength:a.reduce(((e,t)=>e+t.text.length),0),targetLength:c.texts.reduce(((e,t)=>e+t.length),0),nicheIntegration:o}):Ke({installationId:n.installationId,trigger:i.input,websiteLanguage:c.sourceLang,targetLanguage:r,characterCount:a.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:o})}catch(e){console.error(e)}return[{detected_source_language:c.sourceLang,text:c.texts[0],texts:c.texts}]}async function Da(e){await hn();const n=await un(["targetLanguage","session","installationId","regionalVariant"]),a=e.payload.requests,r=e.payload.sourceLang,o=e.payload.targetLang||n.targetLanguage,s=R.gmail,c={sourceLang:r||"auto",targetLangCode:o,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],splitting:"newlines",regionalVariant:n.regionalVariant};let l;try{l=await Zn(c)}catch(t){try{$e({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:o,trigger:i.input,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}fr(),Vr();try{Ke({installationId:n.installationId,trigger:i.manual,websiteLanguage:l.sourceLang,targetLanguage:o,characterCount:a.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:s})}catch(e){console.error(e)}return[{detected_source_language:l.sourceLang,text:l.texts[0],texts:l.texts}]}async function ka(e){await hn();const n=await un(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Zn(r)}catch(t){try{pt({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.length})}catch(e){console.log(e)}throw t}fr();try{Ke({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:R.twitter})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function Pa(e){await hn();const n=await un(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Zn(r)}catch(t){try{$e({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.messageLang,characterCount:a.length,trigger:e.payload.trigger,nicheIntegration:R.linkedIn})}catch(e){console.log(e)}throw t}fr();try{Ke({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:R.linkedIn})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function xa(e){await hn();const n=await un(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Zn(r)}catch(t){try{ut({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.length,numberOfLanguages:1,numberOfMessages:1,translator:b.message})}catch(e){console.log(e)}throw t}fr();try{gt({messageLang:e.payload.messageLang,targetLang:n.selectedTargetLanguage,messageLength:a.length,numberOfLanguages:1,numberOfMessages:1,translator:b.message}),Ke({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:R.whatsappWeb})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function va(e){await hn();const n=await un(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.messages,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:a,splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Zn(r)}catch(t){try{ut({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:a.length,translator:b.chat})}catch(e){console.log(e)}throw t}fr();try{gt({messageLang:e.payload.messageLang,targetLang:n.selectedTargetLanguage,messageLength:a.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:a.length,translator:b.chat}),Ke({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:R.whatsappWeb})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,texts:o.texts}]}async function Ua(e){const{texts:t,mode:n}=e.payload;return await Sa({texts:t,mode:n})}async function Fa(e){await hn();const t=await un(["session","installationId","regionalVariant"]),{mode:n,sentences:a,sourceLang:r,targetLang:o,domain:s}=e.payload,i=a.map(((e,t)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:t<a.length-1?[a[t+1].text]:[],raw_en_context_before:t>0?[a[t-1].text]:[],sentences:[{...e,id:t+1}],...n===Ia.WRITE&&{write_variant_requests:["main"]}}))),c=new Date,l=await ya({mode:n,jobs:i,sourceLang:r,targetLang:o});try{n===Ia.TRANSLATE&&Ke({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:o,characterCount:a.map((e=>e.text)).reduce(((e,t)=>e+t.length),0),translationPerformance:{isFirstTime:!1,processingTimeInMs:new Date-c},domainName:s,nicheIntegration:R.gdocs})}catch(e){console.error(e)}return l}async function Ga(e){const{mode:t,sourceLang:n,targetLang:a,sentence:r,contextBefore:o,contextAfter:s}=e.payload,i=[{kind:"default",preferred_num_beams:4,raw_en_context_after:s?[s]:[],raw_en_context_before:o?[o]:[],sentences:[{...r,partial_translation:"",id:0}],...t===Ia.WRITE&&{write_variant_requests:["main","variants"]}}];return await ya({mode:t,jobs:i,sourceLang:n,targetLang:a})}async function Ma(e){const{mode:t,sourceLang:n,targetLang:a,sentence:r,contextBefore:o,contextAfter:s,partialTranslation:i}=e.payload,c=[{kind:"alternatives_at_position",raw_en_context_after:s?[s]:[],raw_en_context_before:o?[o]:[],sentences:[{...r,partial_translation:i,id:0}],...t===Ia.WRITE&&{write_variant_requests:["main"]}}];return await ya({mode:t,jobs:c,sourceLang:n,targetLang:a})}async function Wa(e){const{mode:t,sourceLang:n,targetLang:a,sentence:r,contextBefore:o,contextAfter:s,partialTranslation:i}=e.payload,c=[{kind:"default",raw_en_context_after:s?[s]:[],raw_en_context_before:o?[o]:[],sentences:[{...r,partial_translation:i,id:0}],...t===Ia.WRITE&&{write_variant_requests:["main"]}}];return await ya({mode:t,jobs:c,sourceLang:n,targetLang:a})}async function Va(e){await hn();const n=await un(["session","installationId","regionalVariant"]),{sourceLang:a,targetLang:r,text:o,trigger:s}=e.payload;let i,c="";const l={sourceLang:a,targetLangCode:r,sessionId:n.session.id,id:t(),sourceTexts:[o],splitting:"paragraphs",regionalVariant:n.regionalVariant};let d;try{d=await Zn(l),c=d.texts?.[0]||""}catch(e){i=e.message}fr(),_r();try{Ke({installationId:n.installationId,trigger:s,websiteLanguage:a,targetLanguage:r,characterCount:o.length,nicheIntegration:R.zendesk})}catch(i){console.error(i)}return[c,i]}async function Ba(e){try{it({language:e.payload.language,domainName:e.payload.domainName})}catch(e){console.error(e)}}async function ja(e){try{Ze({domainName:e})}catch(e){console.error(e)}}async function Ha(e){try{Je({domainName:e.domainName,extensionOpenedFrom:Ee(e.extensionContext)})}catch(e){console.error(e)}}async function qa(e){try{Qe({logoClickedFrom:Te(e.extensionContext)})}catch(e){console.error(e)}}async function Xa(){try{at()}catch(e){console.error(e)}}async function Ka(){try{rt()}catch(e){console.error(e)}}async function Ya(e){try{ot({uiFunction:e.uiFunction,uiLocation:e.uiLocation,nicheIntegration:e.nicheIntegration||R.default})}catch(e){console.error(e)}}async function $a(e){try{st({settingType:e.settingType,newValue:e.newValue,uiFunction:e.uiFunction,uiLocation:e.uiLocation,domainName:e.domainName})}catch(e){console.error(e)}}async function za(e){try{ct({translationType:e.translationType,domainName:e.domainName})}catch(e){console.error(e)}}async function Za(e){try{lt({newPosition:e.newPosition})}catch(e){console.error(e)}}async function Ja(e){try{dt(e)}catch(e){console.error(e)}}async function Qa(e){try{ht(e)}catch(e){console.error(e)}}async function er(e){try{Tt(e)}catch(e){console.error(e)}}async function tr(e){try{mt(e)}catch(e){console.error(e)}}async function nr(e){try{_t(e)}catch(e){console.error(e)}}async function ar(e){try{Et(e)}catch(e){console.error(e)}}async function rr(e){try{Lt(e)}catch(e){console.error(e)}}async function or(e){try{ft(e)}catch(e){console.error(e)}}async function sr(e){try{wt(e)}catch(e){console.error(e)}}async function ir(e){try{Rt(e)}catch(e){console.error(e)}}async function cr(e=!1){const t=await Pn(e);return chrome.runtime.sendMessage({action:"dlExperimentsUpdated",payload:{experiments:[...t]}}),t}async function lr(){Kn()}async function dr(){Yn({trigger:N.user})}async function gr(){return{isLoggedIn:await _n(),isProUser:await fn()}}async function ur(e){switch(e.type){case p.hintKeyboardShortcut:{const e=await chrome.storage.sync.get(["notificationsViewed"]);if(e.notificationsViewed&&e.notificationsViewed.hintKeyboardShortcut)return;await chrome.storage.sync.set({notificationsViewed:{...e.notificationsViewed,hintKeyboardShortcut:!0}});break}}try{et({notificationType:e.type})}catch(e){console.error(e)}const t=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(t[0].id,{action:"dlShowNotification",payload:e})}async function pr(){return await chrome.commands.getAll()}async function hr(e){const t=await pr();try{tt({shortcutType:e.shortcutType,location:e.location,shortcut:t.filter((t=>t.name===e.shortcutType))[0].shortcut,nicheIntegration:e.nicheIntegration||R.default})}catch(e){console.error(e)}}async function mr(e){nt({uiAction:e.uiAction,nicheIntegration:e.nicheIntegration||R.default})}function Er(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlTranslateSelectionRightClick",payload:e})}))}async function Tr(e){try{It(e)}catch(e){console.error(e)}}async function _r(){const e=(await chrome.storage.sync.get(["zendeskSuccessfulTranslations"])).zendeskSuccessfulTranslations+1;await chrome.storage.sync.set({zendeskSuccessfulTranslations:e})}async function fr(){const e=await chrome.storage.sync.get(["isReviewPopupShown","successfulTranslations"]),t=e.successfulTranslations+1;let n=e.isReviewPopupShown;if(!n&&t>=y){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowAskForAReviewPopup"}),n=!0}await chrome.storage.sync.set({isReviewPopupShown:n,successfulTranslations:t})}async function wr(e,t){let n=Y(e.lang);if(qe())await function(e,t,n){const a=new SpeechSynthesisUtterance(e);a.lang=t,a.onend=function(){n()},speechSynthesis.speak(a)}(e.text,n.langCodeForSpeech,(()=>{chrome.tabs.sendMessage(t,{action:"dlVoiceOverStopped"})}));else{const a={lang:n.langCodeForSpeech,onEvent:function(e){"end"===e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverStopped"}),"error"==e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverErrorOccurred"})}};(function(){const e=navigator?.userAgentData?.platform||navigator?.platform||void 0;return e&&-1!==e?.toUpperCase().indexOf("MAC")})()&&(a.rate=.9,n.voice&&L.chrome===chrome.runtime.id&&(a.voiceName=n.voice)),await chrome.tts.speak(e.text,a)}}async function Ir(){let e;return e=qe()?await new Promise(((e,t)=>{if("speechSynthesis"in window){const t=speechSynthesis.getVoices();t.length>0?e(t):speechSynthesis.onvoiceschanged=()=>{const t=speechSynthesis.getVoices();e(t)}}else t(new Error("SpeechSynthesis not supported"))})):await chrome.tts.getVoices(),e.map((e=>K(e.lang)))}async function Lr(){if(!qe())return chrome.tts.stop();speechSynthesis.cancel()}async function Sr(e){try{St(e)}catch(e){console.error(e)}}async function yr(e){try{Nt(e)}catch(e){console.error(e)}}async function Rr(e){try{yt(e)}catch(e){console.error(e)}}async function Ar(e){try{Ct(e)}catch(e){console.error(e)}}async function Nr(e){return await Qn(e)}async function Cr(e){try{Ot(e)}catch(e){console.error(e)}}async function Or(e){try{bt()}catch(e){console.error(e)}}async function br(e){try{Dt()}catch(e){console.error(e)}}async function Dr({eventType:e,zendeskMetaData:t}){try{Pt(e,t)}catch(e){console.error(e)}}async function kr(e){try{kt(e)}catch(e){console.error(e)}}async function Pr(e){try{Ut(e)}catch(e){console.error(e)}}async function xr(e){try{Ft(e)}catch(e){console.error(e)}}async function vr(e){try{Mt(e)}catch(e){console.error(e)}}async function Ur(e){try{Wt(e)}catch(e){console.error(e)}}async function Fr({eventType:e,deeplWriteMetaData:t}){try{jt(e,t)}catch(e){console.error(e)}}async function Gr(e){await hn();const n=await un(["selectedTargetLanguage","session"]),a=e.payload.requests,r={sourceLang:e.payload?.sourceLang?e.payload.sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],isWriteRequest:!0,...e.payload.isHtml&&{isHtml:!0}};let o;return o=await Zn(r),[{detected_source_language:o.sourceLang,text:o.texts[0],texts:o.texts}]}async function Mr({eventType:e,acceptOrRevertMetadata:t}){try{Kt(e,t)}catch(e){console.error(e)}}async function Wr(e){try{Yt(e)}catch(e){console.error(e)}}async function Vr(){const e=await chrome.storage.sync.get(["wasGmailFeedbackPopupShown","successfulTranslationsGmail"]),t=e.successfulTranslationsGmail+1;let n=e.wasGmailFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowGmailFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGmailFeedbackPopupShown:n,successfulTranslationsGmail:t})}async function Br(e){try{$t(e)}catch(e){console.error(e)}}async function jr(){const e=await chrome.storage.sync.get(["wasGSlidesFeedbackPopupShown","successfulTranslationsGSlides"]),t=e.successfulTranslationsGSlides+1;let n=e.wasGSlidesFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowSlidesFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGSlidesFeedbackPopupShown:n,successfulTranslationsGSlides:t})}async function Hr({eventType:e,alternativesMetaData:t}){try{Qt(e,t)}catch(e){console.error(e)}}async function qr(e=!1,t=!0){let n;try{n=await Xn(e,t)}catch(e){throw e.name===xn.INVALID_GRANT&&Yn({trigger:N.extension,reason:e.name,showAlert:!0}),e}return n}async function Xr(){return await kn()}function Kr(e){try{zt(e)}catch(e){console.error(e)}}function Yr(e){try{Zt(e)}catch(e){console.error(e)}}function $r(e,t){try{Jt(e,t)}catch(e){console.error(e)}}async function zr({text:e}){return await La({texts:[e],targetLang:"EN",mode:Ia.WRITE})}const Zr={syncExperiments:"sync_experiments",syncClientState:"sync_client_state"};function Jr(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}const Qr={developer_tools:"DEVELOPER_TOOLS",settings_page:"SETTINGS_PAGE",settings_writing:"SETTINGS_WRITING",settings_reading:"SETTINGS_READING",settings_customizations:"SETTINGS_CUSTOMIZATIONS",onboarding:"ONBOARDING",onboarding_after_account_creation:"ONBOARDING_AFTER_ACCOUNT_CREATION",onboarding_after_successful_login:"ONBOARDING_AFTER_SUCCESSFUL_LOGIN",firefox_first_run:"FIREFOX_FIRST_RUN",privacy_policy:"PRIVACY_POLICY",create_account:"CREATE_ACCOUNT"},eo={DEVELOPER_TOOLS:"dev-page.html",SETTINGS_PAGE:"settings.html",SETTINGS_READING:"settings.html#inline-translation",SETTINGS_WRITING:"settings.html#input-translation",SETTINGS_CUSTOMIZATIONS:"settings.html#customizations",ONBOARDING:"onboarding.html",ONBOARDING_FIREFOX:"onboarding-firefox.html",ONBOARDING_AFTER_ACCOUNT_CREATION:"onboarding.html#account-created",ONBOARDING_AFTER_SUCCESSFUL_LOGIN:"onboarding.html#successful-login",FIREFOX_FIRST_RUN:"firefox-first-run.html",PRIVACY_POLICY:"privacy-policy.html",CREATE_ACCOUNT:"create-account.html"};function to({payload:e}){const{destination:t,openInSameTab:n}=e;if(void 0===t)return;let a="";switch(t){case Qr.developer_tools:a=no(eo.DEVELOPER_TOOLS);break;case Qr.settings_page:a=no(eo.SETTINGS_PAGE);break;case Qr.settings_writing:a=no(eo.SETTINGS_WRITING);break;case Qr.settings_reading:a=no(eo.SETTINGS_READING);break;case Qr.settings_customizations:a=no(eo.SETTINGS_CUSTOMIZATIONS);break;case Qr.onboarding:a=qe()?no(eo.ONBOARDING_FIREFOX):no(eo.ONBOARDING);break;case Qr.onboarding_after_account_creation:a=no(eo.ONBOARDING_AFTER_ACCOUNT_CREATION);break;case Qr.onboarding_after_successful_login:a=no(eo.ONBOARDING_AFTER_SUCCESSFUL_LOGIN);break;case Qr.firefox_first_run:a=no(eo.FIREFOX_FIRST_RUN);break;case Qr.privacy_policy:a=no(eo.PRIVACY_POLICY);break;case Qr.create_account:a=no(eo.CREATE_ACCOUNT)}a&&(n?chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=e[0];chrome.tabs.update(t.id,{url:a})})):chrome.tabs.create({url:a,active:!0}))}function no(e){return chrome.runtime.getURL(e)}function ao(e,t,n){switch(J()&&console.log(t.tab?`message from a content script: ${t.tab.url} with tab id: ${t.tab.id}. action: ${e.action}`:`message from the extension with action: ${e.action}`),e.action){case"dlRequestHtmlTranslation":Ca(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestInlineTranslation":Oa(e).then((e=>{n(e)})).catch((e=>{n(ue(e))}));break;case"dlTriggerTranslateInline":Na(t.tab.id);break;case"dlRequestInputTranslation":ba(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestGmailReceivedEmailTranslation":Da(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestWhatsAppMessageTranslation":xa(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestTwitterTweetTranslation":ka(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestLinkedInPostTranslation":Pa(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestZendeskMessageTranslation":Va(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestWhatsAppMessagesTranslation":va(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestGDocsSplitText":Ua(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestGDocsProcessContent":Fa(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestGDocsSentenceAlternatives":Ga(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestGDocsWordAlternatives":Ma(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlRequestGDocsSentenceFromPartialTranslation":Wa(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlTrackDetectLanguage":Ba(e),n();break;case"dlRequestLogin":lr().then((()=>n(!0))).catch((e=>{n(ue(e))}));break;case"dlRequestLogout":dr().then((()=>n(!0))).catch((e=>{n(ue(e))}));break;case"dlGetAppSettings":chrome.storage.sync.get(null,(function(e){n(e)}));break;case"dlUpdateAppSettings":chrome.storage.sync.set(e.payload,(function(){n(e.payload)}));break;case"dlTranslatedInputTextNotSet":ze({errorCode:ae,errorMessage:"The translated text could not be set",domainName:e.payload}),n();break;case"dlGetUserState":gr().then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlExternalURLRedirect":j(e.payload),n();break;case"dlOpenInternalPage":to(e),n();break;case"dlTrackInputTranslationInjection":ja(e.payload),n();break;case"dlTrackExtensionOpenedEvent":Ha(e.payload),n();break;case"dlTrackLogoClickedEvent":qa(e.payload),n();break;case"dlTrackDocTransClick":Xa(),n();break;case"dlTrackRecommendToAFriendClick":Ka(),n();break;case"dlSendNotification":ur(e.payload),n();break;case"dlCheckCommandShortcuts":pr().then((e=>n(e)));break;case"dlTrackUseOfShortcut":hr(e.payload),n();break;case"dlTrackUiAction":mr(e.payload),n();break;case"dlTrackInlineSettingOpened":Ya(e.payload),n();break;case"dlTrackSettingChanged":$a(e.payload),n();break;case"dlTrackUILocationClicked":Ur(e.payload),n();break;case"dlTrackRightClick":za(e.payload),n();break;case"dlTrackInlinePositionChange":Za(e.payload),n();break;case"dlTrackInlineDragStart":Ja(),n();break;case"dlTrackFptHide":Qa(e.payload);break;case"dlTrackInlineCopy":tr(e.payload),n();break;case"dlTrackInlineListen":ar(e.payload),n();break;case"dlTrackIconHover":er(e.payload),n();break;case"dlTrackVoiceOverStops":rr(e.payload),n();break;case"dlTrackOnboardingStepChange":nr(e.payload),n();break;case"dlTrackOnboardingOpenExternalLink":or(e.payload),n();break;case"dlTrackReadMore":sr(e.payload),n();break;case"dlTrackLandingOnWebsite":Tr(e.payload),n();break;case"dlTrackGDocsReplaceText":ir(e.payload),n();break;case"dlGetExperiments":cr(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlGetClientState":qr(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlTextToSpeech":wr(e.payload,t.tab.id).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlGetDictionary":Nr(e.payload).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlGetSupportedVoices":Ir(e.payload).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlStopSpeech":Lr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackOpenInputHighlighter":Sr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackOpenInlineHighlighter":yr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackCloseInputHighlighter":Rr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackCloseInlineHighlighter":Ar(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackDictionaryStatus":Cr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackOpenDictionarySection":Or(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackDisabledDictionaryHover":br(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackZendeskCustomizationEvent":Dr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackDeeplWriteEvent":Fr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackLingueeErrorData":kr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackGdocsMaxCharExceededShown":Pr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackGDocsMaxCharExceededTryProClicked":xr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackOnboardingModalShown":vr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlRequestImproveWriting":Gr(e).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlTrackTranslateAcceptOrRevertEvent":Mr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackCustomizationEnabledEvent":Wr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTrackGmailCharLimitReached":Br(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlGetUsersCharacterLimit":Xr().then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlTrackAlternativesEvent":Hr(e.payload).then((()=>n())).catch((e=>{n(ue(e))}));break;case"dlTestClassicAPI":zr(e.payload).then((e=>n(e))).catch((e=>{n(ue(e))}));break;case"dlOnSuccessfulZendeskTranslation":_r();break;case"dlTrackUpgradeNotificationIsDisplayed":Kr(e.payload.type);break;case"dlTrackUpgradeNotificationClosed":Yr(e.payload.type);break;case"dlTrackUpgradeNotificationAction":$r(e.payload.type,e.payload.cta)}return!0}function ro(e){switch(console.log(`Command "${e}" triggered`),e){case m.triggerTranslation:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlTriggerTranslationShortcut"})}));break;case m.changeLanguage:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlChangeLanguageShortcut"})}))}}function oo(e){try{qr(!0),chrome.runtime.setUninstallURL("https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU"),e.reason===chrome.runtime.OnInstalledReason.UPDATE&&console.log(`Update from version ${e.previousVersion} to ${chrome.runtime.getManifest().version} was completed`),async function(){let e=!1;const t=await chrome.storage.sync.get(null),n=$();if(!t||!t.settingSchemeVersion||t.settingSchemeVersion<n.settingSchemeVersion){let a={};for(const[r,o]of Object.entries(n))r in t&&"settingSchemeVersion"!==r?a[r]=t[r]:("installationId"===r&&(e=!0),a[r]=o);await chrome.storage.sync.clear(),await chrome.storage.sync.set(a),console.log("settings set: ",a)}return{installationIdWasSet:e}}().then((t=>{!async function(e,t){const n=await Cn();n||e!==chrome.runtime.OnInstalledReason.INSTALL?n||await Nn():(await Nn(),At(),Bt());t&&Vt()}(e.reason,t.installationIdWasSet)})).finally((()=>{try{cr(!0),async function(){await chrome.alarms.clearAll(),await chrome.alarms.create(Zr.syncExperiments,{delayInMinutes:10,periodInMinutes:10}),await chrome.alarms.create(Zr.syncClientState,{delayInMinutes:30,periodInMinutes:30})}()}catch(e){console.error(e)}})),e.reason===chrome.runtime.OnInstalledReason.INSTALL&&Z()!==z.test&&(qe()?to({payload:{destination:Qr.firefox_first_run}}):to({payload:{destination:Qr.create_account}})),chrome.contextMenus.removeAll((function(){chrome.contextMenus.create({type:"normal",id:"dlChangeLanguageShortcut",title:chrome.i18n.getMessage("extension_settings_keyboard_shortcut_change_language"),checked:!1,contexts:["all"]},(function(){})),chrome.contextMenus.create({type:"normal",id:"dlTranslateInline",title:chrome.i18n.getMessage("context_menus_translate_section"),checked:!1,contexts:["all"]})})),chrome.tabs.query({},(function(e){for(const t of e)Jr(t)&&chrome.scripting.executeScript({target:{tabId:t},files:["build/content.js"]})}))}catch(e){Ye({errorCode:ne,errorMessage:e.message})}}function so(e){switch(e.name){case Zr.syncExperiments:cr();break;case Zr.syncClientState:qr()}}function io(e){switch(e.menuItemId){case"dlTranslateInline":Er(!1);break;case"dlChangeLanguageShortcut":Er(!0)}}function co(){}async function lo(e,t,n){const{hasUserSeenAccountCreationOnboarding:a}=await chrome.storage.sync.get(["hasUserSeenAccountCreationOnboarding"]);if(a)return;const r=new URL(n.url),o=r.hostname,s=r.hash;["test.deepl.com","deepl.com"].includes(o)&&["#signup_successful","#clearance_register_success"].includes(s)&&to({payload:{destination:Qr.onboarding_after_account_creation,openInSameTab:!0}})}const go={setBrowserExtensionUserAgent:{type:"modifyHeaders",requestHeaders:[{header:"user-agent",operation:"set",value:`DeepLBrowserExtension/1.15.0 ${navigator.userAgent} `}]}},uo={lingueeDomainFilter:{excludedDomains:["linguee.com"],urlFilter:"*://www-app.linguee.com*",resourceTypes:["xmlhttprequest"]},deeplToolingApiDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://*.deepl.com/jsonrpc?client=chrome-extension,*",resourceTypes:["xmlhttprequest"]},deeplStatisticsDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://s.deepl.*/chrome/statistics*",resourceTypes:["xmlhttprequest"]}};function po(){if(chrome.declarativeNetRequest)chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[2,3,4],addRules:[{id:2,priority:1,action:go.setBrowserExtensionUserAgent,condition:uo.lingueeDomainFilter},{id:3,priority:1,action:go.setBrowserExtensionUserAgent,condition:uo.deeplToolingApiDomainFilter},{id:4,priority:1,action:go.setBrowserExtensionUserAgent,condition:uo.deeplStatisticsDomainFilter}]},(async e=>{J()&&await console.log("created",e)}));else if(chrome.webRequest?.onBeforeSendHeaders){const e=J()?"https://test.deepl.com/":"https://www.deepl.com/";browser.webRequest.onBeforeSendHeaders.addListener((t=>{const n=t.requestHeaders;return n.push({name:"Referer",value:e}),{requestHeaders:n}}),{urls:["*://*.deepl.com/jsonrpc?client=chrome-extension,*"]},["requestHeaders","blocking"]),browser.webRequest.onBeforeSendHeaders.addListener((function(e){for(const t of e.requestHeaders)if("User-Agent"===t.name){t.value=`DeepLBrowserExtension/1.15.0 ${navigator.userAgent}`;break}return{requestHeaders:e.requestHeaders}}),{urls:["*://www-app.linguee.com/*","*://*.deepl.com/jsonrpc?client=chrome-extension,*","https://s.deepl.com/chrome/statistics"]},["blocking","requestHeaders"])}}return po(),chrome.runtime.onInstalled.addListener(oo),chrome.contextMenus.onClicked.addListener(io),chrome.tabs.onActivated.addListener((async function(e){Jr((await chrome.tabs.get(e.tabId)).url)&&chrome.tabs.sendMessage(e.tabId,{action:"dlTabChanged"}),chrome.tabs.query({},(function(t){for(var n=0;n<t.length;++n)chrome.tabs.sendMessage(t[n].id,{action:"dlChangeActiveTabStatus",payload:{isActive:t[n].id===e.tabId}})})),qr()})),chrome.runtime.onConnect.addListener((e=>{J()&&console.log(`port connected to tab with id: ${e.sender.tab.id}`)})),chrome.runtime.onMessage.addListener(ao),chrome.storage.onChanged.addListener(co),chrome.commands.onCommand.addListener(ro),chrome.alarms.onAlarm.addListener(so),self.addEventListener("error",(function(e){Q(e.message)})),chrome.runtime.onMessage.addListener((e=>{"reload"===e&&chrome.tabs.query({active:!0}).then((()=>{chrome.runtime.reload(),chrome.tabs.reload()}))})),chrome.tabs.onUpdated.addListener(lo),e.CONTENT_PROCESS_MODE=Ia,e.INTERNAL_PAGE_KEYS=Qr,e.PERODIC_CODE_EXECUTION_NAMES=Zr,e.URL_ACTIONS=W,e.URL_LIST=V,e.cacheClientState=sn,e.cacheExperiments=ln,e.checkCommandShortcuts=pr,e.checkForNewAccountCreation=lo,e.clearLoginTimestamp=Sn,e.commandListener=ro,e.connectDatabase=an,e.deleteAuthTokens=En,e.fetchClientState=Xn,e.fetchExperiments=Pn,e.fetchGDocsSentenceAlternatives=Ga,e.fetchGDocsWordAlternatives=Ma,e.getAccountID=On,e.getAuthTokens=Tn,e.getBrowserInstanceId=Cn,e.getCachedClientState=cn,e.getCachedExperiments=gn,e.getCharacterLimit=kn,e.getClientState=qr,e.getCurrentExperiments=dn,e.getDapAlternativesSegmentationType=Me,e.getDapApiConfig=pe,e.getDapApiExtensionOpenedFromId=Ee,e.getDapApiInlinePositionType=ye,e.getDapApiLingueeError=me,e.getDapApiLogoClickedFromId=Te,e.getDapApiNotificationType=_e,e.getDapApiSettingType=Se,e.getDapApiShortcutTypes=we,e.getDapApiTranslationTriggerId=he,e.getDapApiUiActionEventId=Ie,e.getDapApiUiFunctionality=Le,e.getDapApiUiLocation=fe,e.getDapContentProcessingModeType=Fe,e.getDapGmailActionType=ve,e.getDapLogoutTrigger=De,e.getDapNicheIntegration=Oe,e.getDapOnboardingExternalLink=Re,e.getDapOnboardingStepChangeTrigger=Ae,e.getDapOriginStore=Ne,e.getDapServiceLevel=xe,e.getDapSessionType=We,e.getDapSessionTypeTrigger=ke,e.getDapUpgradeNotificationAction=Ge,e.getDapUpgradeNotificationType=Ue,e.getDapWhatsAppTranslator=Pe,e.getDictionary=Nr,e.getExperiments=cr,e.getExperimentsData=bn,e.getExternalUrl=B,e.getInstallationId=In,e.getSecondsSinceLastLogin=yn,e.getSessionType=wn,e.getSettings=un,e.getSupportedVoices=Ir,e.getUserInfo=An,e.getUserState=gr,e.getUserType=Dn,e.getUsersCharacterLimit=Xr,e.getWebsiteIdFromWebsite=Ce,e.handleJobs=ya,e.handleSuccessfulGmailTranslationsCount=Vr,e.handleSuccessfulGslidesTranslationsCount=jr,e.handleSuccessfulZendeskTranslationsCount=_r,e.improveWriting=Gr,e.isPayloadNecessaryForUIEvent=be,e.isProUser=fn,e.isUserLoggedIn=_n,e.jsonrpc_callFunction=zn,e.jsonrpc_composeMethodCallDict=qn,e.listenToPerodicCodeExecution=so,e.login=Kn,e.loginRequest=lr,e.logout=Yn,e.logoutRequest=dr,e.markLoginTimestamp=Ln,e.messageListener=ao,e.onContextMenuClicked=io,e.onInstalled=oo,e.onStorageChanged=co,e.openInternalPage=to,e.performGDocsProcessContent=Fa,e.performGDocsSplitText=Ua,e.processContent=La,e.readData=on,e.rebuildGDocsSentenceFromPartialTranslation=Wa,e.redirectToExternalURL=j,e.requestDictionary=Qn,e.sendDAPAlternativesEvent=Qt,e.sendDAPBrowserInstanceIdCreated=Bt,e.sendDAPCloseInlineHighlighter=Ct,e.sendDAPCloseInputHighlighter=yt,e.sendDAPContentScriptErrorData=ze,e.sendDAPCustomizationEnabled=Yt,e.sendDAPDeeplWriteEvent=jt,e.sendDAPDetectLanguage=it,e.sendDAPDictionaryStatus=Ot,e.sendDAPDisabledDictionaryHover=Dt,e.sendDAPDocTransClick=at,e.sendDAPErrorData=Ye,e.sendDAPExtensionOpened=Je,e.sendDAPFPTHide=ht,e.sendDAPFTPBlockSizeExceeded=async function(e){return Xe((t=>({...t,eventId:60006,fptBlockSizeExceededData:{translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},domainName:e.domainName}})))},e.sendDAPGDocsMaxCharExceededShown=Ut,e.sendDAPGDocsMaxCharExceededTryProClicked=Ft,e.sendDAPGDocsReplaceText=Rt,e.sendDAPGmailCharLimitReached=$t,e.sendDAPIconHover=Tt,e.sendDAPInlineCopy=mt,e.sendDAPInlineDragStart=dt,e.sendDAPInlineListen=Et,e.sendDAPInlinePositionChange=lt,e.sendDAPInlineSettingOpened=ot,e.sendDAPInputTranslationInjection=Ze,e.sendDAPInstallSuccess=At,e.sendDAPInstallationIdCreated=Vt,e.sendDAPLandingOnSpecificWebsite=It,e.sendDAPLingueeErrorData=kt,e.sendDAPLoggedIn=qt,e.sendDAPLoggedOut=Xt,e.sendDAPLogin=xt,e.sendDAPLogoClicked=Qe,e.sendDAPLogout=vt,e.sendDAPNotificationViewed=et,e.sendDAPOnboardingModalShown=Mt,e.sendDAPOnboardingOpenExternalPage=ft,e.sendDAPOnboardingStepChange=_t,e.sendDAPOpenDictionarySection=bt,e.sendDAPOpenInlineHighlighter=Nt,e.sendDAPOpenInputHighlighter=St,e.sendDAPReadMoreClicked=wt,e.sendDAPRecommendToAFriendClick=rt,e.sendDAPRightClick=ct,e.sendDAPSessionStarted=Ht,e.sendDAPSettingsChanged=st,e.sendDAPShortcutUsed=tt,e.sendDAPTrackUpgradeNotificationAction=Jt,e.sendDAPTrackUpgradeNotificationClosed=Zt,e.sendDAPTrackUpgradeNotificationDisplayed=zt,e.sendDAPTranslateAcceptOrUndoEvent=Kt,e.sendDAPTranslationErrorData=$e,e.sendDAPTranslationRequest=Ke,e.sendDAPTwitterTweetTranslationFailed=pt,e.sendDAPUILocationClicked=Wt,e.sendDAPUiAction=nt,e.sendDAPVoiceOverStops=Lt,e.sendDAPWhatsAppMessageTranslated=gt,e.sendDAPWhatsAppMessageTranslationFailed=ut,e.sendDAPZendeskCustomizationEvent=Pt,e.sendDAPtrackSessionType=Gt,e.sendNotification=ur,e.setAuthTokens=mn,e.setBrowserInstanceId=Nn,e.setUserInfoFromClientState=Rn,e.splitText=Sa,e.stopSpeech=Lr,e.testClassicApi=zr,e.textToSpeech=wr,e.trackAlternativesEvent=Hr,e.trackCloseInlineHighlighter=Ar,e.trackCloseInputHighlighter=Rr,e.trackCustomizationEnabled=Wr,e.trackDeeplWriteEvent=Fr,e.trackDetectLanguage=Ba,e.trackDictionaryStatus=Cr,e.trackDisabledDictionaryHover=br,e.trackDocTransClick=Xa,e.trackExtensionOpenedEvent=Ha,e.trackFptHide=Qa,e.trackGDocsMaxCharExceededTryProClicked=xr,e.trackGDocsReplaceText=ir,e.trackGdocsMaxCharExceededShown=Pr,e.trackGmailCharLimitReached=Br,e.trackIconHover=er,e.trackInlineCopy=tr,e.trackInlineDragStart=Ja,e.trackInlineListen=ar,e.trackInlinePositionChange=Za,e.trackInlineSettingsOpened=Ya,e.trackInputTranslationInjection=ja,e.trackLandingOnWebsite=Tr,e.trackLingueeErrorData=kr,e.trackLogoClickedEvent=qa,e.trackOnboardingModalShown=vr,e.trackOnboardingOpenExternalLink=or,e.trackOnboardingStepChange=nr,e.trackOpenDictionarySection=Or,e.trackOpenInlineHighlighter=yr,e.trackOpenInputHighlighter=Sr,e.trackReadMoreClick=sr,e.trackRecommendToAFriendClick=Ka,e.trackRightClick=za,e.trackSettingChanged=$a,e.trackTranslateAcceptOrUndoEvent=Mr,e.trackUILocationClicked=Ur,e.trackUiAction=mr,e.trackUpgradeNotificationAction=$r,e.trackUpgradeNotificationClosed=Yr,e.trackUpgradeNotificationDisplayed=Kr,e.trackUseOfShortcut=hr,e.trackVoiceOverStops=rr,e.trackZendeskCustomizationEvent=Dr,e.translate=Zn,e.translateGmailReceivedEmail=Da,e.translateHtmlRequest=Ca,e.translateInlineRequest=Oa,e.translateInputRequest=ba,e.translateLinkedInPostRequest=Pa,e.translateSelection=Er,e.translateTwitterTweetRequest=ka,e.translateWhatsAppMessageRequest=xa,e.translateWhatsAppMessagesRequest=va,e.translateZendeskMessageRequest=Va,e.triggerTranslateInline=Na,e.updateDynamicRules=po,e.updateSession=hn,e.writeData=rn,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=background.js.map
